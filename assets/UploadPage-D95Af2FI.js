import{c as L,r as h,j as e,B as S,C as U,I as Z,m as k,a as $,X as ke,b as Ce,d as Re,u as Ee,e as T,f as M,g as Pe,P as F,h as Ie,i as De,k as Te,l as Me,n as P,S as ee,o as _e,s as Ae}from"./index-BE_vF9cb.js";import{u as ze,c as ie}from"./index-Xb8mjM3N.js";import{T as Be,a as Fe,b as te,c as se}from"./tabs-EhgRIYR2.js";import{X as ne}from"./XpBadge-D0lVq1bW.js";import{A as Ve}from"./arrow-left-C_UnaP_M.js";/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Le=L("Contrast",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"M12 18a6 6 0 0 0 0-12v12z",key:"j4l70d"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ke=L("Droplets",[["path",{d:"M7 16.3c2.2 0 4-1.83 4-4.05 0-1.16-.57-2.26-1.71-3.19S7.29 6.75 7 5.3c-.29 1.45-1.14 2.84-2.29 3.76S3 11.1 3 12.25c0 2.22 1.8 4.05 4 4.05z",key:"1ptgy4"}],["path",{d:"M12.56 6.6A10.97 10.97 0 0 0 14 3.02c.5 2.5 2 4.9 4 6.5s3 3.5 3 5.5a6.98 6.98 0 0 1-11.91 4.97",key:"1sl1rz"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Oe=L("RotateCcw",[["path",{d:"M3 12a9 9 0 1 0 9-9 9.75 9.75 0 0 0-6.74 2.74L3 8",key:"1357e3"}],["path",{d:"M3 3v5h5",key:"1xhq8a"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const He=L("Sun",[["circle",{cx:"12",cy:"12",r:"4",key:"4exip2"}],["path",{d:"M12 2v2",key:"tus03m"}],["path",{d:"M12 20v2",key:"1lh1kg"}],["path",{d:"m4.93 4.93 1.41 1.41",key:"149t6j"}],["path",{d:"m17.66 17.66 1.41 1.41",key:"ptbguv"}],["path",{d:"M2 12h2",key:"1t8f8n"}],["path",{d:"M20 12h2",key:"1q8mjw"}],["path",{d:"m6.34 17.66-1.41 1.41",key:"1m8zz5"}],["path",{d:"m19.07 4.93-1.41 1.41",key:"1shlcs"}]]),G={none:"none",grayscale:"grayscale(100%)",sepia:"sepia(100%)",vintage:"sepia(50%) contrast(90%) brightness(90%)",warm:"saturate(150%) hue-rotate(-10deg) brightness(105%)",cool:"saturate(90%) hue-rotate(10deg) brightness(95%)",dramatic:"contrast(130%) saturate(120%) brightness(90%)",fade:"contrast(90%) brightness(110%) saturate(80%)"},ae={none:"Оригинал",grayscale:"Ч/Б",sepia:"Сепия",vintage:"Винтаж",warm:"Тёплый",cool:"Холодный",dramatic:"Драма",fade:"Выцветший"};async function Ue(s,a){return new Promise((i,c)=>{const n=new Image;n.crossOrigin="anonymous",n.onload=()=>{const o=document.createElement("canvas"),t=o.getContext("2d");if(!t){c(new Error("Could not get canvas context"));return}o.width=n.width,o.height=n.height,t.filter=G[a],t.drawImage(n,0,0),i(o.toDataURL("image/jpeg",.9))},n.onerror=()=>c(new Error("Failed to load image")),n.src=s})}async function $e(s,a=1920,i=.8){return new Promise((c,n)=>{const o=new FileReader;o.onload=t=>{var d;const r=new Image;r.onload=()=>{const m=document.createElement("canvas"),f=m.getContext("2d");if(!f){n(new Error("Could not get canvas context"));return}let{width:l,height:u}=r;l>a&&(u=u*a/l,l=a),m.width=l,m.height=u,f.drawImage(r,0,0,l,u),c(m.toDataURL("image/jpeg",i))},r.onerror=()=>n(new Error("Failed to load image")),r.src=(d=t.target)==null?void 0:d.result},o.onerror=()=>n(new Error("Failed to read file")),o.readAsDataURL(s)})}async function Xe(s,a=200){return new Promise((i,c)=>{const n=new Image;n.crossOrigin="anonymous",n.onload=()=>{const o=document.createElement("canvas"),t=o.getContext("2d");if(!t){c(new Error("Could not get canvas context"));return}const r=Math.min(n.width,n.height),d=(n.width-r)/2,m=(n.height-r)/2;o.width=a,o.height=a,t.drawImage(n,d,m,r,r,0,0,a,a),i(o.toDataURL("image/jpeg",.7))},n.onerror=()=>c(new Error("Failed to load image")),n.src=s})}async function Ye(s,a=100,i=100,c=100){return new Promise((n,o)=>{const t=new Image;t.crossOrigin="anonymous",t.onload=()=>{const r=document.createElement("canvas"),d=r.getContext("2d");if(!d){o(new Error("Could not get canvas context"));return}r.width=t.width,r.height=t.height,d.filter=`brightness(${a}%) contrast(${i}%) saturate(${c}%)`,d.drawImage(t,0,0),n(r.toDataURL("image/jpeg",.9))},t.onerror=()=>o(new Error("Failed to load image")),t.src=s})}function qe({onPhotoSelected:s,variant:a="default",disabled:i=!1}){const c=h.useRef(null),n=h.useRef(null),o=async t=>{var d;const r=(d=t.target.files)==null?void 0:d[0];if(r)try{const m=await $e(r,1920,.85);s(m)}catch(m){console.error("Error processing image:",m)}t.target.value=""};return a==="compact"?e.jsxs(e.Fragment,{children:[e.jsx("input",{type:"file",accept:"image/*",capture:"environment",ref:n,onChange:o,className:"hidden"}),e.jsx("input",{type:"file",accept:"image/*",ref:c,onChange:o,className:"hidden"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(S,{variant:"outline",size:"icon",onClick:()=>{var t;return(t=n.current)==null?void 0:t.click()},disabled:i,children:e.jsx(U,{className:"w-5 h-5"})}),e.jsx(S,{variant:"outline",size:"icon",onClick:()=>{var t;return(t=c.current)==null?void 0:t.click()},disabled:i,children:e.jsx(Z,{className:"w-5 h-5"})})]})]}):e.jsxs(e.Fragment,{children:[e.jsx("input",{type:"file",accept:"image/*",capture:"environment",ref:n,onChange:o,className:"hidden"}),e.jsx("input",{type:"file",accept:"image/*",ref:c,onChange:o,className:"hidden"}),e.jsxs(k.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},className:"flex flex-col gap-4 w-full max-w-sm",children:[e.jsxs(S,{size:"lg",className:"h-14 gap-3 bg-gradient-to-r from-primary to-primary/80",onClick:()=>{var t;return(t=n.current)==null?void 0:t.click()},disabled:i,children:[e.jsx(U,{className:"w-6 h-6"}),e.jsx("span",{className:"text-lg",children:"Сделать фото"})]}),e.jsxs(S,{size:"lg",variant:"outline",className:"h-14 gap-3",onClick:()=>{var t;return(t=c.current)==null?void 0:t.click()},disabled:i,children:[e.jsx(Z,{className:"w-6 h-6"}),e.jsx("span",{className:"text-lg",children:"Выбрать из галереи"})]})]})]})}const re=["none","grayscale","sepia","vintage","warm","cool","dramatic","fade"];function Ge({imageUrl:s,selectedFilter:a,onFilterSelect:i}){const[c,n]=h.useState({});return h.useEffect(()=>{s&&(async()=>{const t={};for(const r of re)t[r]=s;n(t)})()},[s]),e.jsxs("div",{className:"w-full",children:[e.jsx("h3",{className:"text-sm font-medium text-muted-foreground mb-3",children:"Фильтры"}),e.jsx("div",{className:"flex gap-3 overflow-x-auto pb-2 scrollbar-hide",children:re.map((o,t)=>e.jsxs(k.button,{initial:{opacity:0,scale:.8},animate:{opacity:1,scale:1},transition:{delay:t*.05},onClick:()=>i(o),className:$("flex-shrink-0 flex flex-col items-center gap-2 p-1 rounded-lg transition-all",a===o?"ring-2 ring-primary ring-offset-2 ring-offset-background":"hover:bg-secondary"),children:[e.jsx("div",{className:"w-16 h-16 rounded-lg overflow-hidden bg-secondary",style:{filter:G[o]},children:e.jsx("img",{src:c[o]||s,alt:ae[o],className:"w-full h-full object-cover"})}),e.jsx("span",{className:$("text-xs",a===o?"text-primary font-medium":"text-muted-foreground"),children:ae[o]})]},o))})]})}function Je({imageUrl:s,filter:a="none",onRemove:i,onReset:c,showControls:n=!0}){return e.jsxs(k.div,{initial:{opacity:0,scale:.95},animate:{opacity:1,scale:1},className:"relative w-full aspect-square max-w-md mx-auto rounded-2xl overflow-hidden bg-secondary",children:[e.jsx("img",{src:s,alt:"Preview",className:"w-full h-full object-cover",style:{filter:G[a]}}),n&&e.jsxs("div",{className:"absolute top-3 right-3 flex gap-2",children:[c&&e.jsx(S,{size:"icon",variant:"secondary",className:"w-10 h-10 rounded-full bg-black/50 hover:bg-black/70 backdrop-blur-sm",onClick:c,children:e.jsx(Oe,{className:"w-5 h-5"})}),i&&e.jsx(S,{size:"icon",variant:"secondary",className:"w-10 h-10 rounded-full bg-black/50 hover:bg-black/70 backdrop-blur-sm",onClick:i,children:e.jsx(ke,{className:"w-5 h-5"})})]}),e.jsx("div",{className:"absolute inset-x-0 bottom-0 h-20 bg-gradient-to-t from-black/50 to-transparent pointer-events-none"})]})}var ce=["PageUp","PageDown"],le=["ArrowUp","ArrowDown","ArrowLeft","ArrowRight"],de={"from-left":["Home","PageDown","ArrowDown","ArrowLeft"],"from-right":["Home","PageDown","ArrowDown","ArrowRight"],"from-bottom":["Home","PageDown","ArrowDown","ArrowLeft"],"from-top":["Home","PageDown","ArrowUp","ArrowLeft"]},_="Slider",[X,Qe,We]=Ce(_),[ue,yt]=Re(_,[We]),[Ze,K]=ue(_),me=h.forwardRef((s,a)=>{const{name:i,min:c=0,max:n=100,step:o=1,orientation:t="horizontal",disabled:r=!1,minStepsBetweenThumbs:d=0,defaultValue:m=[c],value:f,onValueChange:l=()=>{},onValueCommit:u=()=>{},inverted:p=!1,form:j,...b}=s,v=h.useRef(new Set),x=h.useRef(0),w=t==="horizontal"?et:tt,[g=[],C]=Ee({prop:f,defaultProp:m,onChange:y=>{var I;(I=[...v.current][x.current])==null||I.focus(),l(y)}}),A=h.useRef(g);function O(y){const R=ot(g,y);z(y,R)}function Se(y){z(y,x.current)}function Ne(){const y=A.current[x.current];g[x.current]!==y&&u(g)}function z(y,R,{commit:I}={commit:!1}){const Q=dt(o),H=ut(Math.round((y-c)/o)*o+c,Q),B=ie(H,[c,n]);C((D=[])=>{const E=at(D,B,R);if(lt(E,d*o)){x.current=E.indexOf(B);const W=String(E)!==String(D);return W&&I&&u(E),W?E:D}else return D})}return e.jsx(Ze,{scope:s.__scopeSlider,name:i,disabled:r,min:c,max:n,valueIndexToChangeRef:x,thumbs:v.current,values:g,orientation:t,form:j,children:e.jsx(X.Provider,{scope:s.__scopeSlider,children:e.jsx(X.Slot,{scope:s.__scopeSlider,children:e.jsx(w,{"aria-disabled":r,"data-disabled":r?"":void 0,...b,ref:a,onPointerDown:T(b.onPointerDown,()=>{r||(A.current=g)}),min:c,max:n,inverted:p,onSlideStart:r?void 0:O,onSlideMove:r?void 0:Se,onSlideEnd:r?void 0:Ne,onHomeKeyDown:()=>!r&&z(c,0,{commit:!0}),onEndKeyDown:()=>!r&&z(n,g.length-1,{commit:!0}),onStepKeyDown:({event:y,direction:R})=>{if(!r){const H=ce.includes(y.key)||y.shiftKey&&le.includes(y.key)?10:1,B=x.current,D=g[B],E=o*H*R;z(D+E,B,{commit:!0})}}})})})})});me.displayName=_;var[fe,he]=ue(_,{startEdge:"left",endEdge:"right",size:"width",direction:1}),et=h.forwardRef((s,a)=>{const{min:i,max:c,dir:n,inverted:o,onSlideStart:t,onSlideMove:r,onSlideEnd:d,onStepKeyDown:m,...f}=s,[l,u]=h.useState(null),p=M(a,w=>u(w)),j=h.useRef(void 0),b=Pe(n),v=b==="ltr",x=v&&!o||!v&&o;function N(w){const g=j.current||l.getBoundingClientRect(),C=[0,g.width],O=J(C,x?[i,c]:[c,i]);return j.current=g,O(w-g.left)}return e.jsx(fe,{scope:s.__scopeSlider,startEdge:x?"left":"right",endEdge:x?"right":"left",direction:x?1:-1,size:"width",children:e.jsx(ge,{dir:b,"data-orientation":"horizontal",...f,ref:p,style:{...f.style,"--radix-slider-thumb-transform":"translateX(-50%)"},onSlideStart:w=>{const g=N(w.clientX);t==null||t(g)},onSlideMove:w=>{const g=N(w.clientX);r==null||r(g)},onSlideEnd:()=>{j.current=void 0,d==null||d()},onStepKeyDown:w=>{const C=de[x?"from-left":"from-right"].includes(w.key);m==null||m({event:w,direction:C?-1:1})}})})}),tt=h.forwardRef((s,a)=>{const{min:i,max:c,inverted:n,onSlideStart:o,onSlideMove:t,onSlideEnd:r,onStepKeyDown:d,...m}=s,f=h.useRef(null),l=M(a,f),u=h.useRef(void 0),p=!n;function j(b){const v=u.current||f.current.getBoundingClientRect(),x=[0,v.height],w=J(x,p?[c,i]:[i,c]);return u.current=v,w(b-v.top)}return e.jsx(fe,{scope:s.__scopeSlider,startEdge:p?"bottom":"top",endEdge:p?"top":"bottom",size:"height",direction:p?1:-1,children:e.jsx(ge,{"data-orientation":"vertical",...m,ref:l,style:{...m.style,"--radix-slider-thumb-transform":"translateY(50%)"},onSlideStart:b=>{const v=j(b.clientY);o==null||o(v)},onSlideMove:b=>{const v=j(b.clientY);t==null||t(v)},onSlideEnd:()=>{u.current=void 0,r==null||r()},onStepKeyDown:b=>{const x=de[p?"from-bottom":"from-top"].includes(b.key);d==null||d({event:b,direction:x?-1:1})}})})}),ge=h.forwardRef((s,a)=>{const{__scopeSlider:i,onSlideStart:c,onSlideMove:n,onSlideEnd:o,onHomeKeyDown:t,onEndKeyDown:r,onStepKeyDown:d,...m}=s,f=K(_,i);return e.jsx(F.span,{...m,ref:a,onKeyDown:T(s.onKeyDown,l=>{l.key==="Home"?(t(l),l.preventDefault()):l.key==="End"?(r(l),l.preventDefault()):ce.concat(le).includes(l.key)&&(d(l),l.preventDefault())}),onPointerDown:T(s.onPointerDown,l=>{const u=l.target;u.setPointerCapture(l.pointerId),l.preventDefault(),f.thumbs.has(u)?u.focus():c(l)}),onPointerMove:T(s.onPointerMove,l=>{l.target.hasPointerCapture(l.pointerId)&&n(l)}),onPointerUp:T(s.onPointerUp,l=>{const u=l.target;u.hasPointerCapture(l.pointerId)&&(u.releasePointerCapture(l.pointerId),o(l))})})}),xe="SliderTrack",pe=h.forwardRef((s,a)=>{const{__scopeSlider:i,...c}=s,n=K(xe,i);return e.jsx(F.span,{"data-disabled":n.disabled?"":void 0,"data-orientation":n.orientation,...c,ref:a})});pe.displayName=xe;var Y="SliderRange",ve=h.forwardRef((s,a)=>{const{__scopeSlider:i,...c}=s,n=K(Y,i),o=he(Y,i),t=h.useRef(null),r=M(a,t),d=n.values.length,m=n.values.map(u=>ye(u,n.min,n.max)),f=d>1?Math.min(...m):0,l=100-Math.max(...m);return e.jsx(F.span,{"data-orientation":n.orientation,"data-disabled":n.disabled?"":void 0,...c,ref:r,style:{...s.style,[o.startEdge]:f+"%",[o.endEdge]:l+"%"}})});ve.displayName=Y;var q="SliderThumb",be=h.forwardRef((s,a)=>{const i=Qe(s.__scopeSlider),[c,n]=h.useState(null),o=M(a,r=>n(r)),t=h.useMemo(()=>c?i().findIndex(r=>r.ref.current===c):-1,[i,c]);return e.jsx(st,{...s,ref:o,index:t})}),st=h.forwardRef((s,a)=>{const{__scopeSlider:i,index:c,name:n,...o}=s,t=K(q,i),r=he(q,i),[d,m]=h.useState(null),f=M(a,N=>m(N)),l=d?t.form||!!d.closest("form"):!0,u=Ie(d),p=t.values[c],j=p===void 0?0:ye(p,t.min,t.max),b=rt(c,t.values.length),v=u==null?void 0:u[r.size],x=v?it(v,j,r.direction):0;return h.useEffect(()=>{if(d)return t.thumbs.add(d),()=>{t.thumbs.delete(d)}},[d,t.thumbs]),e.jsxs("span",{style:{transform:"var(--radix-slider-thumb-transform)",position:"absolute",[r.startEdge]:`calc(${j}% + ${x}px)`},children:[e.jsx(X.ItemSlot,{scope:s.__scopeSlider,children:e.jsx(F.span,{role:"slider","aria-label":s["aria-label"]||b,"aria-valuemin":t.min,"aria-valuenow":p,"aria-valuemax":t.max,"aria-orientation":t.orientation,"data-orientation":t.orientation,"data-disabled":t.disabled?"":void 0,tabIndex:t.disabled?void 0:0,...o,ref:f,style:p===void 0?{display:"none"}:s.style,onFocus:T(s.onFocus,()=>{t.valueIndexToChangeRef.current=c})})}),l&&e.jsx(we,{name:n??(t.name?t.name+(t.values.length>1?"[]":""):void 0),form:t.form,value:p},c)]})});be.displayName=q;var nt="RadioBubbleInput",we=h.forwardRef(({__scopeSlider:s,value:a,...i},c)=>{const n=h.useRef(null),o=M(n,c),t=ze(a);return h.useEffect(()=>{const r=n.current;if(!r)return;const d=window.HTMLInputElement.prototype,f=Object.getOwnPropertyDescriptor(d,"value").set;if(t!==a&&f){const l=new Event("input",{bubbles:!0});f.call(r,a),r.dispatchEvent(l)}},[t,a]),e.jsx(F.input,{style:{display:"none"},...i,ref:o,defaultValue:a})});we.displayName=nt;function at(s=[],a,i){const c=[...s];return c[i]=a,c.sort((n,o)=>n-o)}function ye(s,a,i){const o=100/(i-a)*(s-a);return ie(o,[0,100])}function rt(s,a){return a>2?`Value ${s+1} of ${a}`:a===2?["Minimum","Maximum"][s]:void 0}function ot(s,a){if(s.length===1)return 0;const i=s.map(n=>Math.abs(n-a)),c=Math.min(...i);return i.indexOf(c)}function it(s,a,i){const c=s/2,o=J([0,50],[0,c]);return(c-o(a)*i)*i}function ct(s){return s.slice(0,-1).map((a,i)=>s[i+1]-a)}function lt(s,a){if(a>0){const i=ct(s);return Math.min(...i)>=a}return!0}function J(s,a){return i=>{if(s[0]===s[1]||a[0]===a[1])return a[0];const c=(a[1]-a[0])/(s[1]-s[0]);return a[0]+c*(i-s[0])}}function dt(s){return(String(s).split(".")[1]||"").length}function ut(s,a){const i=Math.pow(10,a);return Math.round(s*i)/i}var je=me,mt=pe,ft=ve,ht=be;const V=h.forwardRef(({className:s,...a},i)=>e.jsxs(je,{ref:i,className:$("relative flex w-full touch-none select-none items-center",s),...a,children:[e.jsx(mt,{className:"relative h-2 w-full grow overflow-hidden rounded-full bg-secondary",children:e.jsx(ft,{className:"absolute h-full bg-primary"})}),e.jsx(ht,{className:"block h-5 w-5 rounded-full border-2 border-primary bg-background ring-offset-background transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50"})]}));V.displayName=je.displayName;const oe={filter:"none",brightness:100,contrast:100,saturation:100};function gt({imageUrl:s,initialOptions:a,onSave:i,onCancel:c}){const[n,o]=h.useState({...oe,...a}),t=l=>{o(u=>({...u,filter:l}))},r=(l,u)=>{o(p=>({...p,[l]:u[0]}))},d=()=>{o(oe)},m=()=>{i(n)},f=`brightness(${n.brightness}%) contrast(${n.contrast}%) saturate(${n.saturation}%)`;return e.jsxs(k.div,{initial:{opacity:0},animate:{opacity:1},className:"flex flex-col h-full",children:[e.jsx("div",{className:"flex-1 flex items-center justify-center p-4",children:e.jsx("div",{className:"relative w-full max-w-md aspect-square rounded-2xl overflow-hidden bg-secondary",children:e.jsx("img",{src:s,alt:"Edit preview",className:"w-full h-full object-cover",style:{filter:f}})})}),e.jsxs("div",{className:"bg-card border-t border-border p-4 space-y-4",children:[e.jsxs(Be,{defaultValue:"filters",className:"w-full",children:[e.jsxs(Fe,{className:"grid w-full grid-cols-2",children:[e.jsx(te,{value:"filters",children:"Фильтры"}),e.jsx(te,{value:"adjust",children:"Настройки"})]}),e.jsx(se,{value:"filters",className:"mt-4",children:e.jsx(Ge,{imageUrl:s,selectedFilter:n.filter,onFilterSelect:t})}),e.jsxs(se,{value:"adjust",className:"mt-4 space-y-6",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(He,{className:"w-4 h-4 text-muted-foreground"}),e.jsx("span",{className:"text-sm font-medium",children:"Яркость"})]}),e.jsxs("span",{className:"text-sm text-muted-foreground",children:[n.brightness,"%"]})]}),e.jsx(V,{value:[n.brightness],min:50,max:150,step:1,onValueChange:l=>r("brightness",l)})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Le,{className:"w-4 h-4 text-muted-foreground"}),e.jsx("span",{className:"text-sm font-medium",children:"Контраст"})]}),e.jsxs("span",{className:"text-sm text-muted-foreground",children:[n.contrast,"%"]})]}),e.jsx(V,{value:[n.contrast],min:50,max:150,step:1,onValueChange:l=>r("contrast",l)})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Ke,{className:"w-4 h-4 text-muted-foreground"}),e.jsx("span",{className:"text-sm font-medium",children:"Насыщенность"})]}),e.jsxs("span",{className:"text-sm text-muted-foreground",children:[n.saturation,"%"]})]}),e.jsx(V,{value:[n.saturation],min:0,max:200,step:1,onValueChange:l=>r("saturation",l)})]}),e.jsx(S,{variant:"ghost",size:"sm",onClick:d,className:"w-full",children:"Сбросить настройки"})]})]}),e.jsxs("div",{className:"flex gap-3 pt-2",children:[e.jsx(S,{variant:"outline",className:"flex-1",onClick:c,children:"Отмена"}),e.jsx(S,{className:"flex-1",onClick:m,children:"Применить"})]})]})]})}function jt(){const s=De(),[a]=Te(),{toast:i}=Me(),c=a.get("challenge")||P.id,n=a.get("event"),o=a.get("huntTask"),[t,r]=h.useState("select"),[d,m]=h.useState(null),[f,l]=h.useState({filter:"none",brightness:100,contrast:100,saturation:100}),[u,p]=h.useState(!1),j=g=>{m(g),r("preview")},b=()=>{r("edit")},v=g=>{l(g),r("preview")},x=()=>{r("preview")},N=async()=>{if(d){p(!0);try{let g=d;(f.brightness!==100||f.contrast!==100||f.saturation!==100)&&(g=await Ye(g,f.brightness,f.contrast,f.saturation)),f.filter!=="none"&&(g=await Ue(g,f.filter));const C=await Xe(g,200),A={id:_e(),userId:"user-1",imageData:g,thumbnailData:C,challengeId:c||void 0,eventId:n||void 0,huntTaskId:o||void 0,createdAt:new Date().toISOString(),likes:0,comments:0,isTop:!1,filter:f.filter};await Ae(A),r("success"),i({title:"Фото загружено!",description:`+${P.xpReward} XP`}),setTimeout(()=>{s("/gallery")},2e3)}catch(g){console.error("Error uploading photo:",g),i({title:"Ошибка",description:"Не удалось загрузить фото",variant:"destructive"})}finally{p(!1)}}},w=()=>{t==="preview"?(m(null),r("select")):t==="edit"?r("preview"):s(-1)};return e.jsxs("div",{className:"min-h-screen bg-background",children:[e.jsx("header",{className:"sticky top-0 z-40 bg-background/80 backdrop-blur-lg border-b border-border",children:e.jsxs("div",{className:"container mx-auto px-4 h-16 flex items-center justify-between",children:[e.jsx(S,{variant:"ghost",size:"icon",onClick:w,children:e.jsx(Ve,{className:"w-5 h-5"})}),e.jsxs("h1",{className:"font-display text-lg font-semibold",children:[t==="select"&&"Загрузить фото",t==="preview"&&"Предпросмотр",t==="edit"&&"Редактирование",t==="success"&&"Готово!"]}),e.jsx("div",{className:"w-10"})," "]})}),e.jsxs("main",{className:"container mx-auto px-4 py-6",children:[t==="select"&&e.jsxs(k.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},className:"flex flex-col items-center justify-center min-h-[60vh] gap-8",children:[e.jsxs("div",{className:"text-center max-w-sm",children:[e.jsxs("div",{className:"inline-flex items-center gap-2 px-4 py-2 rounded-full bg-secondary border border-border mb-4",children:[e.jsx(U,{className:"w-4 h-4 text-primary"}),e.jsxs("span",{className:"text-sm font-medium",children:["День #",P.dayNumber]})]}),e.jsx("h2",{className:"font-display text-2xl font-bold mb-2",children:P.title}),e.jsx("p",{className:"text-muted-foreground text-sm mb-4",children:P.description}),e.jsx(ne,{xp:P.xpReward})]}),e.jsx(qe,{onPhotoSelected:j})]}),t==="preview"&&d&&e.jsxs(k.div,{initial:{opacity:0},animate:{opacity:1},className:"flex flex-col gap-6",children:[e.jsx(Je,{imageUrl:d,filter:f.filter,onRemove:()=>{m(null),r("select")}}),e.jsxs("div",{className:"flex flex-col gap-3 max-w-md mx-auto w-full",children:[e.jsxs(S,{variant:"outline",size:"lg",onClick:b,className:"gap-2",children:[e.jsx(ee,{className:"w-5 h-5"}),"Редактировать"]}),e.jsx(S,{size:"lg",onClick:N,disabled:u,className:"gap-2 bg-gradient-to-r from-primary to-primary/80",children:u?"Загрузка...":"Отправить"})]})]}),t==="edit"&&d&&e.jsx("div",{className:"fixed inset-0 z-50 bg-background",children:e.jsx(gt,{imageUrl:d,initialOptions:f,onSave:v,onCancel:x})}),t==="success"&&e.jsxs(k.div,{initial:{opacity:0,scale:.9},animate:{opacity:1,scale:1},className:"flex flex-col items-center justify-center min-h-[60vh] gap-6 text-center",children:[e.jsx(k.div,{initial:{scale:0},animate:{scale:1},transition:{type:"spring",stiffness:500,damping:30,delay:.2},className:"w-24 h-24 rounded-full bg-gradient-to-br from-primary to-accent flex items-center justify-center",children:e.jsx(ee,{className:"w-12 h-12 text-primary-foreground"})}),e.jsxs("div",{children:[e.jsx("h2",{className:"font-display text-2xl font-bold mb-2",children:"Отлично!"}),e.jsx("p",{className:"text-muted-foreground",children:"Ваше фото успешно загружено"})]}),e.jsx(ne,{xp:P.xpReward,size:"lg",animated:!0})]})]})]})}export{jt as default};
