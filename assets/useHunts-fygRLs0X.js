import{_ as i,y as a,$ as l,a0 as f,a1 as d,a2 as g}from"./index-X3YY-C0S.js";async function y(){if(!i)return[];const{data:e,error:r}=await a.from("hunts").select("*").eq("is_active",!0).order("created_at",{ascending:!1});if(r)return console.error("Error fetching hunts:",r),[];if(!e||e.length===0)return[];const t=e.map(s=>s.id),{data:n}=await a.from("hunt_tasks").select("hunt_id").in("hunt_id",t),o={};return(n||[]).forEach(s=>{o[s.hunt_id]=(o[s.hunt_id]||0)+1}),e.map(s=>({...s,task_count:o[s.id]||0}))}async function h(e){if(!i)return null;const[r,t]=await Promise.all([a.from("hunts").select("*").eq("id",e).single(),a.from("hunt_tasks").select("*").eq("hunt_id",e).order("order_num")]);return r.error||!r.data?(console.error("Error fetching hunt:",r.error),null):{hunt:r.data,tasks:t.data||[]}}async function c(e){if(!i)return null;const{data:{user:r}}=await a.auth.getUser();if(!r)return null;const{data:t,error:n}=await a.from("hunt_progress").select("*").eq("hunt_id",e).eq("user_id",r.id).single();return n&&n.code!=="PGRST116"&&console.error("Error fetching hunt progress:",n),t}async function _(e){if(!i)return null;const{data:{user:r}}=await a.auth.getUser();if(!r)return null;const{data:t,error:n}=await a.from("hunt_progress").insert({hunt_id:e,user_id:r.id,completed_tasks:[],total_xp_earned:0}).select().single();return n?(console.error("Error starting hunt:",n),null):t}async function p(e,r,t){var o;if(!i)return null;const{data:{user:n}}=await a.auth.getUser();if(!n)return null;try{const{error:s}=await a.rpc("complete_hunt_task",{p_hunt_id:e,p_task_id:r,p_photo_id:t});return s?(o=s.message)!=null&&o.includes("already completed")?c(e):(console.error("Error completing hunt task:",s),null):c(e)}catch(s){return console.error("Error in completeHuntTask:",s),null}}async function m(){if(!i)return[];const{data:{user:e}}=await a.auth.getUser();if(!e)return[];const{data:r,error:t}=await a.from("hunt_progress").select("*").eq("user_id",e.id);return t?(console.error("Error fetching hunt progress:",t),[]):r||[]}const u={all:["hunts"],active:()=>[...u.all,"active"],detail:e=>[...u.all,"detail",e],progress:e=>[...u.all,"progress",e],userProgress:()=>[...u.all,"userProgress"]};function k(){return l({queryKey:u.active(),queryFn:y,staleTime:10*60*1e3})}function H(e){return l({queryKey:u.detail(e||""),queryFn:()=>h(e),enabled:!!e,staleTime:10*60*1e3})}function w(e){return l({queryKey:u.progress(e||""),queryFn:()=>c(e),enabled:!!e,staleTime:60*1e3})}function P(){return l({queryKey:u.userProgress(),queryFn:m,staleTime:5*60*1e3})}function v(){const e=f();return d({mutationFn:r=>_(r),onSuccess:(r,t)=>{r&&(e.setQueryData(u.progress(t),r),e.invalidateQueries({queryKey:u.userProgress()}))}})}function T(){const e=f();return d({mutationFn:({huntId:r,taskId:t,photoId:n})=>p(r,t,n),onSuccess:(r,{huntId:t})=>{r&&(e.setQueryData(u.progress(t),r),e.invalidateQueries({queryKey:u.userProgress()}),e.invalidateQueries({queryKey:["profile"]}),g())}})}export{H as a,k as b,P as c,w as d,v as e,T as u};
