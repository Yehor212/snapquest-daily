import{c as b,j as e,D as _,w as T,B as c,x as D,y as P,n as L,z as C,r as O,A,E as B,T as I,i as F,k as g,l as y,L as f,m as v,I as u}from"./index-BQQ8k2S_.js";import{P as k}from"./PhotoGallery-DC1Yy3Wt.js";import{E as x}from"./EmptyState-BY8k-Inp.js";import{A as M}from"./arrow-left-Z5wnwJql.js";import{P as z}from"./plus-CLox-Stq.js";import"./index-DNKPPDmp.js";/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const E=b("ArrowUpDown",[["path",{d:"m21 16-4 4-4-4",key:"f6ql7i"}],["path",{d:"M17 20V4",key:"1ejh1v"}],["path",{d:"m3 8 4-4 4 4",key:"11wl7u"}],["path",{d:"M7 4v16",key:"1glfcx"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const G=b("Filter",[["polygon",{points:"22 3 2 3 10 12.46 10 19 14 21 14 12.46 22 3",key:"1yg77f"}]]);function S({filter:a,onFilterChange:r}){var o;const t=[{value:"date",label:"По дате"},{value:"likes",label:"По лайкам"}],d=i=>{a.sortBy===i?r({sortOrder:a.sortOrder==="desc"?"asc":"desc"}):r({sortBy:i,sortOrder:"desc"})},m=()=>{r({isTop:a.isTop?void 0:!0})};return e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs(_,{children:[e.jsx(T,{asChild:!0,children:e.jsxs(c,{variant:"outline",size:"sm",className:"gap-2",children:[e.jsx(E,{className:"w-4 h-4"}),e.jsx("span",{className:"hidden sm:inline",children:(o=t.find(i=>i.value===a.sortBy))==null?void 0:o.label})]})}),e.jsx(D,{align:"end",children:t.map(i=>e.jsxs(P,{onClick:()=>d(i.value),children:[i.label,a.sortBy===i.value&&e.jsx("span",{className:"ml-2 text-muted-foreground",children:a.sortOrder==="desc"?"↓":"↑"})]},i.value))})]}),e.jsxs(c,{variant:a.isTop?"default":"outline",size:"sm",className:"gap-2",onClick:m,children:[e.jsx(G,{className:"w-4 h-4"}),e.jsx("span",{className:"hidden sm:inline",children:"Только TOP"})]})]})}function K(){const a=L(),{user:r}=C(),[t,d]=O.useState({sortBy:"date",sortOrder:"desc"}),{data:m,isLoading:o}=A(50),{data:i,isLoading:w}=B(r==null?void 0:r.id),N=n=>{d(s=>({...s,...n}))},h=(m||[]).filter(n=>!(t.isTop&&n.likes_count<10)).sort((n,s)=>{const l=t.sortOrder==="desc"?-1:1;return t.sortBy==="date"?l*(new Date(s.created_at).getTime()-new Date(n.created_at).getTime()):t.sortBy==="likes"?l*((s.likes_count||0)-(n.likes_count||0)):0}),p=(i||[]).sort((n,s)=>{const l=t.sortOrder==="desc"?-1:1;return t.sortBy==="date"?l*(new Date(s.created_at).getTime()-new Date(n.created_at).getTime()):t.sortBy==="likes"?l*((s.likes_count||0)-(n.likes_count||0)):0}),j=n=>(n||[]).map(s=>({id:s.id,userId:s.user_id,imageData:s.image_url,thumbnailData:s.thumbnail_url||s.image_url,createdAt:s.created_at,likes:s.likes_count,comments:0,isTop:s.likes_count>=10,challengeId:s.challenge_id||void 0,eventId:s.event_id||void 0,huntTaskId:s.hunt_task_id||void 0,filter:s.filter_applied||void 0}));return e.jsxs("div",{className:"min-h-screen bg-background",children:[e.jsx("header",{className:"sticky top-0 z-40 bg-background/80 backdrop-blur-lg border-b border-border",children:e.jsxs("div",{className:"container mx-auto px-4 h-16 flex items-center justify-between",children:[e.jsx(c,{variant:"ghost",size:"icon",onClick:()=>a(-1),children:e.jsx(M,{className:"w-5 h-5"})}),e.jsx("h1",{className:"font-display text-lg font-semibold",children:"Галерея"}),e.jsx(c,{variant:"ghost",size:"icon",onClick:()=>a("/upload"),children:e.jsx(z,{className:"w-5 h-5"})})]})}),e.jsx("main",{className:"container mx-auto px-4 py-6",children:e.jsxs(I,{defaultValue:"all",className:"w-full",children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsxs(F,{children:[e.jsx(g,{value:"all",children:"Все"}),e.jsx(g,{value:"my",children:"Мои фото"})]}),e.jsx(S,{filter:t,onFilterChange:N})]}),e.jsx(y,{value:"all",children:o?e.jsx("div",{className:"flex items-center justify-center py-12",children:e.jsx(f,{className:"w-8 h-8 animate-spin text-primary"})}):h.length>0?e.jsx(v.div,{initial:{opacity:0},animate:{opacity:1},children:e.jsx(k,{photos:j(h),columns:3})}):e.jsx(x,{icon:u,title:"Пока нет фото",description:"Станьте первым, кто загрузит фото!",actionLabel:"Загрузить фото",onAction:()=>a("/upload")})}),e.jsx(y,{value:"my",children:r?w?e.jsx("div",{className:"flex items-center justify-center py-12",children:e.jsx(f,{className:"w-8 h-8 animate-spin text-primary"})}):p.length>0?e.jsx(v.div,{initial:{opacity:0},animate:{opacity:1},children:e.jsx(k,{photos:j(p),columns:3})}):e.jsx(x,{icon:u,title:"У вас пока нет фото",description:"Выполняйте челленджи и ваши фото появятся здесь",actionLabel:"Загрузить первое фото",onAction:()=>a("/upload")}):e.jsx(x,{icon:u,title:"Войдите в аккаунт",description:"Чтобы видеть свои фото, необходимо войти в аккаунт"})})]})})]})}export{K as default};
