import{c as B,r as h,j as e,B as R,C as q,I as ie,m as E,a as te,X as Te,b as _e,d as De,u as Me,e as L,f as K,g as Ae,P as Y,h as Ve,T as Fe,i as ze,k as oe,l as le,n as Le,o as Be,p as Ke,q as $e,s as Oe,t as He,L as X,S as ce,v as Ue}from"./index-DFnNWw_v.js";import{u as Xe,c as he}from"./index-BTBWgO7J.js";import{X as Q}from"./XpBadge-D87dUz-C.js";import{u as qe,a as Ye}from"./useHunts-BTPJHiU3.js";import{A as Ge}from"./arrow-left-kcRMWkuC.js";/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Je=B("CircleCheckBig",[["path",{d:"M21.801 10A10 10 0 1 1 17 3.335",key:"yps3ct"}],["path",{d:"m9 11 3 3L22 4",key:"1pflzl"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const We=B("CircleX",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"m15 9-6 6",key:"1uzhvr"}],["path",{d:"m9 9 6 6",key:"z0biqf"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ze=B("Contrast",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"M12 18a6 6 0 0 0 0-12v12z",key:"j4l70d"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Qe=B("Droplets",[["path",{d:"M7 16.3c2.2 0 4-1.83 4-4.05 0-1.16-.57-2.26-1.71-3.19S7.29 6.75 7 5.3c-.29 1.45-1.14 2.84-2.29 3.76S3 11.1 3 12.25c0 2.22 1.8 4.05 4 4.05z",key:"1ptgy4"}],["path",{d:"M12.56 6.6A10.97 10.97 0 0 0 14 3.02c.5 2.5 2 4.9 4 6.5s3 3.5 3 5.5a6.98 6.98 0 0 1-11.91 4.97",key:"1sl1rz"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const et=B("RotateCcw",[["path",{d:"M3 12a9 9 0 1 0 9-9 9.75 9.75 0 0 0-6.74 2.74L3 8",key:"1357e3"}],["path",{d:"M3 3v5h5",key:"1xhq8a"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const tt=B("Sun",[["circle",{cx:"12",cy:"12",r:"4",key:"4exip2"}],["path",{d:"M12 2v2",key:"tus03m"}],["path",{d:"M12 20v2",key:"1lh1kg"}],["path",{d:"m4.93 4.93 1.41 1.41",key:"149t6j"}],["path",{d:"m17.66 17.66 1.41 1.41",key:"ptbguv"}],["path",{d:"M2 12h2",key:"1t8f8n"}],["path",{d:"M20 12h2",key:"1q8mjw"}],["path",{d:"m6.34 17.66-1.41 1.41",key:"1m8zz5"}],["path",{d:"m19.07 4.93-1.41 1.41",key:"1shlcs"}]]),W={none:"none",grayscale:"grayscale(100%)",sepia:"sepia(100%)",vintage:"sepia(50%) contrast(90%) brightness(90%)",warm:"saturate(150%) hue-rotate(-10deg) brightness(105%)",cool:"saturate(90%) hue-rotate(10deg) brightness(95%)",dramatic:"contrast(130%) saturate(120%) brightness(90%)",fade:"contrast(90%) brightness(110%) saturate(80%)"},de={none:"Оригинал",grayscale:"Ч/Б",sepia:"Сепия",vintage:"Винтаж",warm:"Тёплый",cool:"Холодный",dramatic:"Драма",fade:"Выцветший"};async function ee(s,n){return new Promise((i,t)=>{const a=new Image;a.crossOrigin="anonymous",a.onload=()=>{const o=document.createElement("canvas"),r=o.getContext("2d");if(!r){t(new Error("Could not get canvas context"));return}o.width=a.width,o.height=a.height,r.filter=W[n],r.drawImage(a,0,0),i(o.toDataURL("image/jpeg",.9))},a.onerror=()=>t(new Error("Failed to load image")),a.src=s})}async function st(s,n=1920,i=.8){return new Promise((t,a)=>{const o=new FileReader;o.onload=r=>{var d;const l=new Image;l.onload=()=>{const x=document.createElement("canvas"),y=x.getContext("2d");if(!y){a(new Error("Could not get canvas context"));return}let{width:c,height:u}=l;c>n&&(u=u*n/c,c=n),x.width=c,x.height=u,y.drawImage(l,0,0,c,u),t(x.toDataURL("image/jpeg",i))},l.onerror=()=>a(new Error("Failed to load image")),l.src=(d=r.target)==null?void 0:d.result},o.onerror=()=>a(new Error("Failed to read file")),o.readAsDataURL(s)})}async function ue(s,n){const t=await(await fetch(s)).blob();return new File([t],n,{type:t.type||"image/jpeg"})}async function nt(s,n=100,i=100,t=100){return new Promise((a,o)=>{const r=new Image;r.crossOrigin="anonymous",r.onload=()=>{const l=document.createElement("canvas"),d=l.getContext("2d");if(!d){o(new Error("Could not get canvas context"));return}l.width=r.width,l.height=r.height,d.filter=`brightness(${n}%) contrast(${i}%) saturate(${t}%)`,d.drawImage(r,0,0),a(l.toDataURL("image/jpeg",.9))},r.onerror=()=>o(new Error("Failed to load image")),r.src=s})}function at({onPhotoSelected:s,variant:n="default",disabled:i=!1}){const t=h.useRef(null),a=h.useRef(null),o=async r=>{var d;const l=(d=r.target.files)==null?void 0:d[0];if(l)try{const x=await st(l,1920,.85);s(x)}catch(x){console.error("Error processing image:",x)}r.target.value=""};return n==="compact"?e.jsxs(e.Fragment,{children:[e.jsx("input",{type:"file",accept:"image/*",capture:"environment",ref:a,onChange:o,className:"hidden"}),e.jsx("input",{type:"file",accept:"image/*",ref:t,onChange:o,className:"hidden"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(R,{variant:"outline",size:"icon",onClick:()=>{var r;return(r=a.current)==null?void 0:r.click()},disabled:i,children:e.jsx(q,{className:"w-5 h-5"})}),e.jsx(R,{variant:"outline",size:"icon",onClick:()=>{var r;return(r=t.current)==null?void 0:r.click()},disabled:i,children:e.jsx(ie,{className:"w-5 h-5"})})]})]}):e.jsxs(e.Fragment,{children:[e.jsx("input",{type:"file",accept:"image/*",capture:"environment",ref:a,onChange:o,className:"hidden"}),e.jsx("input",{type:"file",accept:"image/*",ref:t,onChange:o,className:"hidden"}),e.jsxs(E.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},className:"flex flex-col gap-4 w-full max-w-sm",children:[e.jsxs(R,{size:"lg",className:"h-14 gap-3 bg-gradient-to-r from-primary to-primary/80",onClick:()=>{var r;return(r=a.current)==null?void 0:r.click()},disabled:i,children:[e.jsx(q,{className:"w-6 h-6"}),e.jsx("span",{className:"text-lg",children:"Сделать фото"})]}),e.jsxs(R,{size:"lg",variant:"outline",className:"h-14 gap-3",onClick:()=>{var r;return(r=t.current)==null?void 0:r.click()},disabled:i,children:[e.jsx(ie,{className:"w-6 h-6"}),e.jsx("span",{className:"text-lg",children:"Выбрать из галереи"})]})]})]})}const me=["none","grayscale","sepia","vintage","warm","cool","dramatic","fade"];function rt({imageUrl:s,selectedFilter:n,onFilterSelect:i}){const[t,a]=h.useState({});return h.useEffect(()=>{s&&(async()=>{const r={};for(const l of me)r[l]=s;a(r)})()},[s]),e.jsxs("div",{className:"w-full",children:[e.jsx("h3",{className:"text-sm font-medium text-muted-foreground mb-3",children:"Фильтры"}),e.jsx("div",{className:"flex gap-3 overflow-x-auto pb-2 scrollbar-hide",children:me.map((o,r)=>e.jsxs(E.button,{initial:{opacity:0,scale:.8},animate:{opacity:1,scale:1},transition:{delay:r*.05},onClick:()=>i(o),className:te("flex-shrink-0 flex flex-col items-center gap-2 p-1 rounded-lg transition-all",n===o?"ring-2 ring-primary ring-offset-2 ring-offset-background":"hover:bg-secondary"),children:[e.jsx("div",{className:"w-16 h-16 rounded-lg overflow-hidden bg-secondary",style:{filter:W[o]},children:e.jsx("img",{src:t[o]||s,alt:de[o],className:"w-full h-full object-cover"})}),e.jsx("span",{className:te("text-xs",n===o?"text-primary font-medium":"text-muted-foreground"),children:de[o]})]},o))})]})}function it({imageUrl:s,filter:n="none",onRemove:i,onReset:t,showControls:a=!0}){return e.jsxs(E.div,{initial:{opacity:0,scale:.95},animate:{opacity:1,scale:1},className:"relative w-full aspect-square max-w-md mx-auto rounded-2xl overflow-hidden bg-secondary",children:[e.jsx("img",{src:s,alt:"Preview",className:"w-full h-full object-cover",style:{filter:W[n]}}),a&&e.jsxs("div",{className:"absolute top-3 right-3 flex gap-2",children:[t&&e.jsx(R,{size:"icon",variant:"secondary",className:"w-10 h-10 rounded-full bg-black/50 hover:bg-black/70 backdrop-blur-sm",onClick:t,children:e.jsx(et,{className:"w-5 h-5"})}),i&&e.jsx(R,{size:"icon",variant:"secondary",className:"w-10 h-10 rounded-full bg-black/50 hover:bg-black/70 backdrop-blur-sm",onClick:i,children:e.jsx(Te,{className:"w-5 h-5"})})]}),e.jsx("div",{className:"absolute inset-x-0 bottom-0 h-20 bg-gradient-to-t from-black/50 to-transparent pointer-events-none"})]})}var xe=["PageUp","PageDown"],ge=["ArrowUp","ArrowDown","ArrowLeft","ArrowRight"],pe={"from-left":["Home","PageDown","ArrowDown","ArrowLeft"],"from-right":["Home","PageDown","ArrowDown","ArrowRight"],"from-bottom":["Home","PageDown","ArrowDown","ArrowLeft"],"from-top":["Home","PageDown","ArrowUp","ArrowLeft"]},$="Slider",[se,ot,lt]=_e($),[ye,zt]=De($,[lt]),[ct,Z]=ye($),ve=h.forwardRef((s,n)=>{const{name:i,min:t=0,max:a=100,step:o=1,orientation:r="horizontal",disabled:l=!1,minStepsBetweenThumbs:d=0,defaultValue:x=[t],value:y,onValueChange:c=()=>{},onValueCommit:u=()=>{},inverted:p=!1,form:w,...v}=s,m=h.useRef(new Set),f=h.useRef(0),b=r==="horizontal"?dt:ut,[g=[],M]=Me({prop:y,defaultProp:x,onChange:S=>{var _;(_=[...m.current][f.current])==null||_.focus(),c(S)}}),T=h.useRef(g);function z(S){const P=gt(g,S);A(S,P)}function C(S){A(S,f.current)}function O(){const S=T.current[f.current];g[f.current]!==S&&u(g)}function A(S,P,{commit:_}={commit:!1}){const G=wt(o),V=bt(Math.round((S-t)/o)*o+t,G),F=he(V,[t,a]);M((D=[])=>{const I=ht(D,F,P);if(vt(I,d*o)){f.current=I.indexOf(F);const H=String(I)!==String(D);return H&&_&&u(I),H?I:D}else return D})}return e.jsx(ct,{scope:s.__scopeSlider,name:i,disabled:l,min:t,max:a,valueIndexToChangeRef:f,thumbs:m.current,values:g,orientation:r,form:w,children:e.jsx(se.Provider,{scope:s.__scopeSlider,children:e.jsx(se.Slot,{scope:s.__scopeSlider,children:e.jsx(b,{"aria-disabled":l,"data-disabled":l?"":void 0,...v,ref:n,onPointerDown:L(v.onPointerDown,()=>{l||(T.current=g)}),min:t,max:a,inverted:p,onSlideStart:l?void 0:z,onSlideMove:l?void 0:C,onSlideEnd:l?void 0:O,onHomeKeyDown:()=>!l&&A(t,0,{commit:!0}),onEndKeyDown:()=>!l&&A(a,g.length-1,{commit:!0}),onStepKeyDown:({event:S,direction:P})=>{if(!l){const V=xe.includes(S.key)||S.shiftKey&&ge.includes(S.key)?10:1,F=f.current,D=g[F],I=o*V*P;A(D+I,F,{commit:!0})}}})})})})});ve.displayName=$;var[we,be]=ye($,{startEdge:"left",endEdge:"right",size:"width",direction:1}),dt=h.forwardRef((s,n)=>{const{min:i,max:t,dir:a,inverted:o,onSlideStart:r,onSlideMove:l,onSlideEnd:d,onStepKeyDown:x,...y}=s,[c,u]=h.useState(null),p=K(n,b=>u(b)),w=h.useRef(void 0),v=Ae(a),m=v==="ltr",f=m&&!o||!m&&o;function N(b){const g=w.current||c.getBoundingClientRect(),M=[0,g.width],z=re(M,f?[i,t]:[t,i]);return w.current=g,z(b-g.left)}return e.jsx(we,{scope:s.__scopeSlider,startEdge:f?"left":"right",endEdge:f?"right":"left",direction:f?1:-1,size:"width",children:e.jsx(je,{dir:v,"data-orientation":"horizontal",...y,ref:p,style:{...y.style,"--radix-slider-thumb-transform":"translateX(-50%)"},onSlideStart:b=>{const g=N(b.clientX);r==null||r(g)},onSlideMove:b=>{const g=N(b.clientX);l==null||l(g)},onSlideEnd:()=>{w.current=void 0,d==null||d()},onStepKeyDown:b=>{const M=pe[f?"from-left":"from-right"].includes(b.key);x==null||x({event:b,direction:M?-1:1})}})})}),ut=h.forwardRef((s,n)=>{const{min:i,max:t,inverted:a,onSlideStart:o,onSlideMove:r,onSlideEnd:l,onStepKeyDown:d,...x}=s,y=h.useRef(null),c=K(n,y),u=h.useRef(void 0),p=!a;function w(v){const m=u.current||y.current.getBoundingClientRect(),f=[0,m.height],b=re(f,p?[t,i]:[i,t]);return u.current=m,b(v-m.top)}return e.jsx(we,{scope:s.__scopeSlider,startEdge:p?"bottom":"top",endEdge:p?"top":"bottom",size:"height",direction:p?1:-1,children:e.jsx(je,{"data-orientation":"vertical",...x,ref:c,style:{...x.style,"--radix-slider-thumb-transform":"translateY(50%)"},onSlideStart:v=>{const m=w(v.clientY);o==null||o(m)},onSlideMove:v=>{const m=w(v.clientY);r==null||r(m)},onSlideEnd:()=>{u.current=void 0,l==null||l()},onStepKeyDown:v=>{const f=pe[p?"from-bottom":"from-top"].includes(v.key);d==null||d({event:v,direction:f?-1:1})}})})}),je=h.forwardRef((s,n)=>{const{__scopeSlider:i,onSlideStart:t,onSlideMove:a,onSlideEnd:o,onHomeKeyDown:r,onEndKeyDown:l,onStepKeyDown:d,...x}=s,y=Z($,i);return e.jsx(Y.span,{...x,ref:n,onKeyDown:L(s.onKeyDown,c=>{c.key==="Home"?(r(c),c.preventDefault()):c.key==="End"?(l(c),c.preventDefault()):xe.concat(ge).includes(c.key)&&(d(c),c.preventDefault())}),onPointerDown:L(s.onPointerDown,c=>{const u=c.target;u.setPointerCapture(c.pointerId),c.preventDefault(),y.thumbs.has(u)?u.focus():t(c)}),onPointerMove:L(s.onPointerMove,c=>{c.target.hasPointerCapture(c.pointerId)&&a(c)}),onPointerUp:L(s.onPointerUp,c=>{const u=c.target;u.hasPointerCapture(c.pointerId)&&(u.releasePointerCapture(c.pointerId),o(c))})})}),Ne="SliderTrack",Se=h.forwardRef((s,n)=>{const{__scopeSlider:i,...t}=s,a=Z(Ne,i);return e.jsx(Y.span,{"data-disabled":a.disabled?"":void 0,"data-orientation":a.orientation,...t,ref:n})});Se.displayName=Ne;var ne="SliderRange",ke=h.forwardRef((s,n)=>{const{__scopeSlider:i,...t}=s,a=Z(ne,i),o=be(ne,i),r=h.useRef(null),l=K(n,r),d=a.values.length,x=a.values.map(u=>Ee(u,a.min,a.max)),y=d>1?Math.min(...x):0,c=100-Math.max(...x);return e.jsx(Y.span,{"data-orientation":a.orientation,"data-disabled":a.disabled?"":void 0,...t,ref:l,style:{...s.style,[o.startEdge]:y+"%",[o.endEdge]:c+"%"}})});ke.displayName=ne;var ae="SliderThumb",Ce=h.forwardRef((s,n)=>{const i=ot(s.__scopeSlider),[t,a]=h.useState(null),o=K(n,l=>a(l)),r=h.useMemo(()=>t?i().findIndex(l=>l.ref.current===t):-1,[i,t]);return e.jsx(mt,{...s,ref:o,index:r})}),mt=h.forwardRef((s,n)=>{const{__scopeSlider:i,index:t,name:a,...o}=s,r=Z(ae,i),l=be(ae,i),[d,x]=h.useState(null),y=K(n,N=>x(N)),c=d?r.form||!!d.closest("form"):!0,u=Ve(d),p=r.values[t],w=p===void 0?0:Ee(p,r.min,r.max),v=xt(t,r.values.length),m=u==null?void 0:u[l.size],f=m?pt(m,w,l.direction):0;return h.useEffect(()=>{if(d)return r.thumbs.add(d),()=>{r.thumbs.delete(d)}},[d,r.thumbs]),e.jsxs("span",{style:{transform:"var(--radix-slider-thumb-transform)",position:"absolute",[l.startEdge]:`calc(${w}% + ${f}px)`},children:[e.jsx(se.ItemSlot,{scope:s.__scopeSlider,children:e.jsx(Y.span,{role:"slider","aria-label":s["aria-label"]||v,"aria-valuemin":r.min,"aria-valuenow":p,"aria-valuemax":r.max,"aria-orientation":r.orientation,"data-orientation":r.orientation,"data-disabled":r.disabled?"":void 0,tabIndex:r.disabled?void 0:0,...o,ref:y,style:p===void 0?{display:"none"}:s.style,onFocus:L(s.onFocus,()=>{r.valueIndexToChangeRef.current=t})})}),c&&e.jsx(Re,{name:a??(r.name?r.name+(r.values.length>1?"[]":""):void 0),form:r.form,value:p},t)]})});Ce.displayName=ae;var ft="RadioBubbleInput",Re=h.forwardRef(({__scopeSlider:s,value:n,...i},t)=>{const a=h.useRef(null),o=K(a,t),r=Xe(n);return h.useEffect(()=>{const l=a.current;if(!l)return;const d=window.HTMLInputElement.prototype,y=Object.getOwnPropertyDescriptor(d,"value").set;if(r!==n&&y){const c=new Event("input",{bubbles:!0});y.call(l,n),l.dispatchEvent(c)}},[r,n]),e.jsx(Y.input,{style:{display:"none"},...i,ref:o,defaultValue:n})});Re.displayName=ft;function ht(s=[],n,i){const t=[...s];return t[i]=n,t.sort((a,o)=>a-o)}function Ee(s,n,i){const o=100/(i-n)*(s-n);return he(o,[0,100])}function xt(s,n){return n>2?`Value ${s+1} of ${n}`:n===2?["Minimum","Maximum"][s]:void 0}function gt(s,n){if(s.length===1)return 0;const i=s.map(a=>Math.abs(a-n)),t=Math.min(...i);return i.indexOf(t)}function pt(s,n,i){const t=s/2,o=re([0,50],[0,t]);return(t-o(n)*i)*i}function yt(s){return s.slice(0,-1).map((n,i)=>s[i+1]-n)}function vt(s,n){if(n>0){const i=yt(s);return Math.min(...i)>=n}return!0}function re(s,n){return i=>{if(s[0]===s[1]||n[0]===n[1])return n[0];const t=(n[1]-n[0])/(s[1]-s[0]);return n[0]+t*(i-s[0])}}function wt(s){return(String(s).split(".")[1]||"").length}function bt(s,n){const i=Math.pow(10,n);return Math.round(s*i)/i}var Pe=ve,jt=Se,Nt=ke,St=Ce;const J=h.forwardRef(({className:s,...n},i)=>e.jsxs(Pe,{ref:i,className:te("relative flex w-full touch-none select-none items-center",s),...n,children:[e.jsx(jt,{className:"relative h-2 w-full grow overflow-hidden rounded-full bg-secondary",children:e.jsx(Nt,{className:"absolute h-full bg-primary"})}),e.jsx(St,{className:"block h-5 w-5 rounded-full border-2 border-primary bg-background ring-offset-background transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50"})]}));J.displayName=Pe.displayName;const fe={filter:"none",brightness:100,contrast:100,saturation:100};function kt({imageUrl:s,initialOptions:n,onSave:i,onCancel:t}){const[a,o]=h.useState({...fe,...n}),r=p=>{o(w=>({...w,filter:p}))},l=(p,w)=>{o(v=>({...v,[p]:w[0]}))},d=()=>{o(fe)},x=()=>{i(a)},y=W[a.filter],c=`brightness(${a.brightness}%) contrast(${a.contrast}%) saturate(${a.saturation}%)`,u=y!=="none"?`${y} ${c}`:c;return e.jsxs(E.div,{initial:{opacity:0},animate:{opacity:1},className:"flex flex-col h-full",children:[e.jsx("div",{className:"flex-1 flex items-center justify-center p-4",children:e.jsx("div",{className:"relative w-full max-w-md aspect-square rounded-2xl overflow-hidden bg-secondary",children:e.jsx("img",{src:s,alt:"Edit preview",className:"w-full h-full object-cover",style:{filter:u}})})}),e.jsxs("div",{className:"bg-card border-t border-border p-4 space-y-4",children:[e.jsxs(Fe,{defaultValue:"filters",className:"w-full",children:[e.jsxs(ze,{className:"grid w-full grid-cols-2",children:[e.jsx(oe,{value:"filters",children:"Фильтры"}),e.jsx(oe,{value:"adjust",children:"Настройки"})]}),e.jsx(le,{value:"filters",className:"mt-4",children:e.jsx(rt,{imageUrl:s,selectedFilter:a.filter,onFilterSelect:r})}),e.jsxs(le,{value:"adjust",className:"mt-4 space-y-6",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(tt,{className:"w-4 h-4 text-muted-foreground"}),e.jsx("span",{className:"text-sm font-medium",children:"Яркость"})]}),e.jsxs("span",{className:"text-sm text-muted-foreground",children:[a.brightness,"%"]})]}),e.jsx(J,{value:[a.brightness],min:50,max:150,step:1,onValueChange:p=>l("brightness",p)})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Ze,{className:"w-4 h-4 text-muted-foreground"}),e.jsx("span",{className:"text-sm font-medium",children:"Контраст"})]}),e.jsxs("span",{className:"text-sm text-muted-foreground",children:[a.contrast,"%"]})]}),e.jsx(J,{value:[a.contrast],min:50,max:150,step:1,onValueChange:p=>l("contrast",p)})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Qe,{className:"w-4 h-4 text-muted-foreground"}),e.jsx("span",{className:"text-sm font-medium",children:"Насыщенность"})]}),e.jsxs("span",{className:"text-sm text-muted-foreground",children:[a.saturation,"%"]})]}),e.jsx(J,{value:[a.saturation],min:0,max:200,step:1,onValueChange:p=>l("saturation",p)})]}),e.jsx(R,{variant:"ghost",size:"sm",onClick:d,className:"w-full",children:"Сбросить настройки"})]})]}),e.jsxs("div",{className:"flex gap-3 pt-2",children:[e.jsx(R,{variant:"outline",className:"flex-1",onClick:t,children:"Отмена"}),e.jsx(R,{className:"flex-1",onClick:x,children:"Применить"})]})]})]})}const Ct="https://api-inference.huggingface.co/models/openai/clip-vit-base-patch32",Rt={"луч света":["light ray","sunbeam","light beam","sunlight through","ray of light","sun rays","light streaming"],закат:["sunset","golden hour","evening sky","orange sky","sun setting"],рассвет:["sunrise","dawn","morning light","early morning sky"],тень:["shadow","silhouette","dark shadow","shadows"],силуэт:["silhouette","dark figure","outline against light"],цветок:["flower","blossom","petal","bloom","floral"],дерево:["tree","trunk","branches","leaves","forest"],вода:["water","lake","river","ocean","pond","reflection in water"],облака:["clouds","sky","cloudy sky","cloud formation"],капля:["water drop","droplet","dew","rain drop"],архитектура:["architecture","building","facade","structure"],граффити:["graffiti","street art","mural","wall art"],улица:["street","road","urban","city street"],"ночной город":["night city","city lights","urban night","neon lights"],отражение:["reflection","mirror","reflected","glass reflection"],текстура:["texture","pattern","surface","material"],симметрия:["symmetry","symmetric","balanced","mirror image"],минимализм:["minimalist","simple","minimal","clean composition"],контраст:["contrast","light and dark","black and white"],кофе:["coffee","cup of coffee","coffee mug","latte"],книга:["book","reading","pages","literature"],еда:["food","meal","dish","cuisine"]};async function Et(s){return new Promise((n,i)=>{const t=new FileReader;t.onload=()=>{const a=t.result.split(",")[1];n(a)},t.onerror=i,t.readAsDataURL(s)})}async function Pt(s,n,i){const t={"Content-Type":"application/json"};t.Authorization=`Bearer ${i}`;const a=await fetch(Ct,{method:"POST",headers:t,body:JSON.stringify({inputs:{image:s},parameters:{candidate_labels:n}})});if(!a.ok){const o=await a.text();throw new Error(`Hugging Face API error: ${o}`)}return a.json()}function It(s){const n=s.toLowerCase(),i=[];for(const[t,a]of Object.entries(Rt))n.includes(t)&&i.push(...a);if(i.length===0){const t=n.split(/\s+/).filter(a=>a.length>3);i.push(...t.slice(0,5))}return[...new Set(i)]}async function Tt(s,n,i,t){try{const a=`${n} ${i||""}`,o=It(a);if(o.length===0)return{isValid:!0,confidence:.5,matchedKeyword:null,allScores:[],message:"Не удалось определить ключевые слова. Фото принято."};const r=["random object","unrelated image","blank photo"],l=[...o.slice(0,8),...r],d=await Et(s),x=await Pt(d,l,t),c=x.filter(m=>!r.includes(m.label)).reduce((m,f)=>m.score>f.score?m:f,{label:"",score:0}),u=.15,p=.25;let w=!1,v="";return c.score>=p?(w=!0,v=`Отлично! Фото соответствует заданию (${Math.round(c.score*100)}% уверенность)`):c.score>=u?(w=!0,v=`Фото принято (${Math.round(c.score*100)}% соответствие)`):(w=!1,v=`Фото не соответствует заданию. Попробуйте сфотографировать: ${o.slice(0,3).join(", ")}`),{isValid:w,confidence:c.score,matchedKeyword:c.label,allScores:x,message:v}}catch(a){return console.error("Image verification error:",a),{isValid:!0,confidence:0,matchedKeyword:null,allScores:[],message:"Верификация недоступна. Фото принято."}}}function Lt(){const s=Le(),[n]=Be(),{toast:i}=Ke(),{data:t,isLoading:a}=$e(),o=Oe(),r=He(),l=qe(),d=n.get("challengeId")||n.get("challenge")||(t==null?void 0:t.id),x=n.get("event"),y=n.get("eventChallenge"),c=n.get("huntId")||n.get("hunt"),u=n.get("huntTask"),{data:p}=Ye(c||void 0),[w,v]=h.useState(50);h.useEffect(()=>{(async()=>{if(y){const{data:k}=await Ue.from("event_challenges").select("xp_reward").eq("id",y).single();k&&v(k.xp_reward)}else if(u&&(p!=null&&p.tasks)){const k=p.tasks.find(U=>U.id===u);k&&v(k.xp_reward)}else t!=null&&t.xp_reward&&v(t.xp_reward)})()},[y,u,p,t]);const[m,f]=h.useState("select"),[N,b]=h.useState(null),[g,M]=h.useState({filter:"none",brightness:100,contrast:100,saturation:100}),[T,z]=h.useState(!1),[C,O]=h.useState(null),A=j=>{b(j),f("preview")},S=()=>{f("edit")},P=j=>{M(j),f("preview")},_=()=>{f("preview")},G=async()=>{if(N){f("verifying");try{let j=N;(g.brightness!==100||g.contrast!==100||g.saturation!==100)&&(j=await nt(j,g.brightness,g.contrast,g.saturation)),g.filter!=="none"&&(j=await ee(j,g.filter));const k=await ue(j,"photo.jpg");let U={isValid:!0,confidence:1,matchedKeyword:null,allScores:[],message:"Фото принято"};t&&(U=await Tt(k,t.title,t.description||void 0,"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")),O(U),f("verified"),U.isValid&&await V(j)}catch(j){console.error("Verification error:",j),O({isValid:!0,confidence:0,matchedKeyword:null,allScores:[],message:"Верификация недоступна. Фото принято."}),f("verified");let k=N;g.filter!=="none"&&(k=await ee(k,g.filter)),await V(k)}}},V=async j=>{z(!0);try{const k=await ue(j,"photo.jpg");await o.mutateAsync({file:k,options:{challengeId:d||void 0,eventId:x||void 0,eventChallengeId:y||void 0,huntId:c||void 0,huntTaskId:u||void 0,filter:g.filter!=="none"?g.filter:void 0}}),c&&u?await l.mutateAsync({huntId:c,taskId:u,xpReward:w}):await r.mutateAsync(w),f("success"),i({title:"Фото загружено!",description:`+${w} XP`}),setTimeout(()=>{s(c?`/hunts/${c}`:x?`/events/${x}`:"/gallery")},2e3)}catch(k){console.error("Error uploading photo:",k),i({title:"Ошибка",description:"Не удалось загрузить фото",variant:"destructive"}),f("preview")}finally{z(!1)}},F=()=>{b(null),O(null),f("select")},D=async()=>{if(!N)return;let j=N;g.filter!=="none"&&(j=await ee(j,g.filter)),await V(j)},I=()=>{m==="preview"?(b(null),f("select")):m==="edit"||m==="verified"&&!(C!=null&&C.isValid)?f("preview"):s(-1)},H=w,Ie=(t==null?void 0:t.day_number)||1;return e.jsxs("div",{className:"min-h-screen bg-background",children:[e.jsx("header",{className:"sticky top-0 z-40 bg-background/80 backdrop-blur-lg border-b border-border",children:e.jsxs("div",{className:"container mx-auto px-4 h-16 flex items-center justify-between",children:[e.jsx(R,{variant:"ghost",size:"icon",onClick:I,children:e.jsx(Ge,{className:"w-5 h-5"})}),e.jsxs("h1",{className:"font-display text-lg font-semibold",children:[m==="select"&&"Загрузить фото",m==="preview"&&"Предпросмотр",m==="edit"&&"Редактирование",m==="verifying"&&"Проверка фото...",m==="verified"&&(C!=null&&C.isValid?"Проверено!":"Не соответствует"),m==="success"&&"Готово!"]}),e.jsx("div",{className:"w-10"})]})}),e.jsxs("main",{className:"container mx-auto px-4 py-6",children:[m==="select"&&e.jsxs(E.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},className:"flex flex-col items-center justify-center min-h-[60vh] gap-8",children:[a?e.jsxs("div",{className:"flex items-center gap-2 text-muted-foreground",children:[e.jsx(X,{className:"w-5 h-5 animate-spin"}),"Загрузка задания..."]}):t?e.jsxs("div",{className:"text-center max-w-sm",children:[e.jsxs("div",{className:"inline-flex items-center gap-2 px-4 py-2 rounded-full bg-secondary border border-border mb-4",children:[e.jsx(q,{className:"w-4 h-4 text-primary"}),e.jsxs("span",{className:"text-sm font-medium",children:["День #",Ie]})]}),e.jsx("h2",{className:"font-display text-2xl font-bold mb-2",children:t.title}),e.jsx("p",{className:"text-muted-foreground text-sm mb-4",children:t.description}),e.jsx(Q,{xp:H})]}):e.jsxs("div",{className:"text-center max-w-sm",children:[e.jsxs("div",{className:"inline-flex items-center gap-2 px-4 py-2 rounded-full bg-secondary border border-border mb-4",children:[e.jsx(q,{className:"w-4 h-4 text-primary"}),e.jsx("span",{className:"text-sm font-medium",children:"Свободная тема"})]}),e.jsx("h2",{className:"font-display text-2xl font-bold mb-2",children:"Загрузите фото"}),e.jsx("p",{className:"text-muted-foreground text-sm mb-4",children:"Поделитесь своим творчеством"}),e.jsx(Q,{xp:50})]}),e.jsx(at,{onPhotoSelected:A})]}),m==="preview"&&N&&e.jsxs(E.div,{initial:{opacity:0},animate:{opacity:1},className:"flex flex-col gap-6",children:[e.jsx(it,{imageUrl:N,filter:g.filter,onRemove:()=>{b(null),f("select")}}),e.jsxs("div",{className:"flex flex-col gap-3 max-w-md mx-auto w-full",children:[e.jsxs(R,{variant:"outline",size:"lg",onClick:S,className:"gap-2",children:[e.jsx(ce,{className:"w-5 h-5"}),"Редактировать"]}),e.jsx(R,{size:"lg",onClick:G,disabled:T,className:"gap-2 bg-gradient-to-r from-primary to-primary/80",children:T?e.jsxs(e.Fragment,{children:[e.jsx(X,{className:"w-5 h-5 animate-spin"}),"Загрузка..."]}):"Проверить и отправить"})]})]}),m==="edit"&&N&&e.jsx("div",{className:"fixed inset-0 z-50 bg-background",children:e.jsx(kt,{imageUrl:N,initialOptions:g,onSave:P,onCancel:_})}),m==="verifying"&&e.jsxs(E.div,{initial:{opacity:0},animate:{opacity:1},className:"flex flex-col items-center justify-center min-h-[60vh] gap-6 text-center",children:[e.jsx("div",{className:"w-20 h-20 rounded-full bg-secondary flex items-center justify-center",children:e.jsx(X,{className:"w-10 h-10 animate-spin text-primary"})}),e.jsxs("div",{children:[e.jsx("h2",{className:"font-display text-xl font-bold mb-2",children:"AI проверяет фото"}),e.jsx("p",{className:"text-muted-foreground text-sm",children:"Определяем соответствие заданию..."})]})]}),m==="verified"&&C&&e.jsx(E.div,{initial:{opacity:0,scale:.95},animate:{opacity:1,scale:1},className:"flex flex-col items-center justify-center min-h-[60vh] gap-6 text-center",children:C.isValid?e.jsxs(e.Fragment,{children:[e.jsx(E.div,{initial:{scale:0},animate:{scale:1},transition:{type:"spring",stiffness:500,damping:30},className:"w-20 h-20 rounded-full bg-success/20 flex items-center justify-center",children:e.jsx(Je,{className:"w-10 h-10 text-success"})}),e.jsxs("div",{children:[e.jsx("h2",{className:"font-display text-xl font-bold mb-2 text-success",children:"Фото соответствует!"}),e.jsx("p",{className:"text-muted-foreground text-sm max-w-xs",children:C.message}),C.confidence>0&&e.jsxs("p",{className:"text-xs text-muted-foreground mt-2",children:["Уверенность: ",Math.round(C.confidence*100),"%"]})]}),e.jsxs("div",{className:"flex items-center gap-2 text-sm text-muted-foreground",children:[e.jsx(X,{className:"w-4 h-4 animate-spin"}),"Загружаем фото..."]})]}):e.jsxs(e.Fragment,{children:[e.jsx(E.div,{initial:{scale:0},animate:{scale:1},transition:{type:"spring",stiffness:500,damping:30},className:"w-20 h-20 rounded-full bg-destructive/20 flex items-center justify-center",children:e.jsx(We,{className:"w-10 h-10 text-destructive"})}),e.jsxs("div",{children:[e.jsx("h2",{className:"font-display text-xl font-bold mb-2 text-destructive",children:"Не соответствует заданию"}),e.jsx("p",{className:"text-muted-foreground text-sm max-w-xs",children:C.message})]}),e.jsxs("div",{className:"flex flex-col gap-3 w-full max-w-xs",children:[e.jsxs(R,{onClick:F,variant:"outline",className:"gap-2",children:[e.jsx(q,{className:"w-4 h-4"}),"Сделать другое фото"]}),e.jsx(R,{onClick:D,variant:"ghost",size:"sm",className:"text-muted-foreground",disabled:T,children:T?e.jsxs(e.Fragment,{children:[e.jsx(X,{className:"w-4 h-4 mr-2 animate-spin"}),"Загрузка..."]}):"Загрузить всё равно"})]})]})}),m==="success"&&e.jsxs(E.div,{initial:{opacity:0,scale:.9},animate:{opacity:1,scale:1},className:"flex flex-col items-center justify-center min-h-[60vh] gap-6 text-center",children:[e.jsx(E.div,{initial:{scale:0},animate:{scale:1},transition:{type:"spring",stiffness:500,damping:30,delay:.2},className:"w-24 h-24 rounded-full bg-gradient-to-br from-primary to-accent flex items-center justify-center",children:e.jsx(ce,{className:"w-12 h-12 text-primary-foreground"})}),e.jsxs("div",{children:[e.jsx("h2",{className:"font-display text-2xl font-bold mb-2",children:"Отлично!"}),e.jsx("p",{className:"text-muted-foreground",children:"Ваше фото успешно загружено"})]}),e.jsx(Q,{xp:H,size:"lg",animated:!0})]})]})]})}export{Lt as default};
