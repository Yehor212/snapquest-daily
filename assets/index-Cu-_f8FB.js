import{r as s,a8 as A,j as E,a9 as D,aa as b,ab as H,ac as K,ad as U,ae as B}from"./index-BE_vF9cb.js";function L(e,r){if(typeof e=="function")return e(r);e!=null&&(e.current=r)}function F(...e){return r=>{let t=!1;const i=e.map(u=>{const n=L(u,r);return!t&&typeof n=="function"&&(t=!0),n});if(t)return()=>{for(let u=0;u<i.length;u++){const n=i[u];typeof n=="function"?n():L(e[u],null)}}}}function G(...e){return s.useCallback(F(...e),e)}class T extends s.Component{getSnapshotBeforeUpdate(r){const t=this.props.childRef.current;if(t&&r.isPresent&&!this.props.isPresent){const i=t.offsetParent,u=D(i)&&i.offsetWidth||0,n=this.props.sizeRef.current;n.height=t.offsetHeight||0,n.width=t.offsetWidth||0,n.top=t.offsetTop,n.left=t.offsetLeft,n.right=u-n.width-n.left}return null}componentDidUpdate(){}render(){return this.props.children}}function V({children:e,isPresent:r,anchorX:t,root:i}){var h;const u=s.useId(),n=s.useRef(null),d=s.useRef({width:0,height:0,top:0,left:0,right:0}),{nonce:y}=s.useContext(A),w=((h=e.props)==null?void 0:h.ref)??(e==null?void 0:e.ref),c=G(n,w);return s.useInsertionEffect(()=>{const{width:f,height:l,top:a,left:m,right:C}=d.current;if(r||!n.current||!f||!l)return;const P=t==="left"?`left: ${m}`:`right: ${C}`;n.current.dataset.motionPopId=u;const x=document.createElement("style");y&&(x.nonce=y);const M=i??document.head;return M.appendChild(x),x.sheet&&x.sheet.insertRule(`
          [data-motion-pop-id="${u}"] {
            position: absolute !important;
            width: ${f}px !important;
            height: ${l}px !important;
            ${P}px !important;
            top: ${a}px !important;
          }
        `),()=>{M.contains(x)&&M.removeChild(x)}},[r]),E.jsx(T,{isPresent:r,childRef:n,sizeRef:d,children:s.cloneElement(e,{ref:c})})}const X=({children:e,initial:r,isPresent:t,onExitComplete:i,custom:u,presenceAffectsLayout:n,mode:d,anchorX:y,root:w})=>{const c=b(_),h=s.useId();let f=!0,l=s.useMemo(()=>(f=!1,{id:h,initial:r,isPresent:t,custom:u,onExitComplete:a=>{c.set(a,!0);for(const m of c.values())if(!m)return;i&&i()},register:a=>(c.set(a,!1),()=>c.delete(a))}),[t,c,i]);return n&&f&&(l={...l}),s.useMemo(()=>{c.forEach((a,m)=>c.set(m,!1))},[t]),s.useEffect(()=>{!t&&!c.size&&i&&i()},[t]),d==="popLayout"&&(e=E.jsx(V,{isPresent:t,anchorX:y,root:w,children:e})),E.jsx(H.Provider,{value:l,children:e})};function _(){return new Map}const j=e=>e.key||"";function S(e){const r=[];return s.Children.forEach(e,t=>{s.isValidElement(t)&&r.push(t)}),r}const J=({children:e,custom:r,initial:t=!0,onExitComplete:i,presenceAffectsLayout:u=!0,mode:n="sync",propagate:d=!1,anchorX:y="left",root:w})=>{const[c,h]=K(d),f=s.useMemo(()=>S(e),[e]),l=d&&!c?[]:f.map(j),a=s.useRef(!0),m=s.useRef(f),C=b(()=>new Map),P=s.useRef(new Set),[x,M]=s.useState(f),[g,z]=s.useState(f);U(()=>{a.current=!1,m.current=f;for(let p=0;p<g.length;p++){const o=j(g[p]);l.includes(o)?(C.delete(o),P.current.delete(o)):C.get(o)!==!0&&C.set(o,!1)}},[g,l.length,l.join("-")]);const $=[];if(f!==x){let p=[...f];for(let o=0;o<g.length;o++){const R=g[o],v=j(R);l.includes(v)||(p.splice(o,0,R),$.push(R))}return n==="wait"&&$.length&&(p=$),z(S(p)),M(f),null}const{forceRender:k}=s.useContext(B);return E.jsx(E.Fragment,{children:g.map(p=>{const o=j(p),R=d&&!c?!1:f===g||l.includes(o),v=()=>{if(P.current.has(o))return;if(P.current.add(o),C.has(o))C.set(o,!0);else return;let I=!0;C.forEach(W=>{W||(I=!1)}),I&&(k==null||k(),z(m.current),d&&(h==null||h()),i&&i())};return E.jsx(X,{isPresent:R,initial:!a.current||t?void 0:!1,custom:r,presenceAffectsLayout:u,mode:n,root:w,onExitComplete:R?void 0:v,anchorX:y,children:p},o)})})};export{J as A};
