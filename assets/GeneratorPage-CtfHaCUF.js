import{c as N,j as e,m as p,B as f,H as Q,C as Y,r as u,W as Z,S as D,J as M,n as ee,p as te,q as ae,K as se,M as ie,N as re,T as ne,i as oe,k as A,l as z,L as le}from"./index-X3YY-C0S.js";import{X as ce}from"./XpBadge-C-Cp13ih.js";import{D as de}from"./DifficultyBadge-D7p4uoUe.js";import{U as b}from"./index-oazBVSES.js";import{S as I,a as R,b as L,c as B,d as y}from"./select-CdnrKtR6.js";import{E as g}from"./EmptyState-C4Y7FhQ9.js";import{A as me}from"./arrow-left-CtnlzYUZ.js";import{A as ue}from"./index-DWgQ6eXM.js";import{L as v}from"./lightbulb-BRAeW6lj.js";import"./index-ODAm_FIq.js";/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const pe=N("Bookmark",[["path",{d:"m19 21-7-4-7 4V5a2 2 0 0 1 2-2h10a2 2 0 0 1 2 2v16z",key:"1fy3hk"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const G=N("History",[["path",{d:"M3 12a9 9 0 1 0 9-9 9.75 9.75 0 0 0-6.74 2.74L3 8",key:"1357e3"}],["path",{d:"M3 3v5h5",key:"1xhq8a"}],["path",{d:"M12 7v5l4 2",key:"1fdv2h"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const fe=N("Shuffle",[["path",{d:"m18 14 4 4-4 4",key:"10pe0f"}],["path",{d:"m18 2 4 4-4 4",key:"pucp1d"}],["path",{d:"M2 18h1.973a4 4 0 0 0 3.3-1.7l5.454-8.6a4 4 0 0 1 3.3-1.7H22",key:"1ailkh"}],["path",{d:"M2 6h1.972a4 4 0 0 1 3.6 2.2",key:"km57vx"}],["path",{d:"M22 18h-6.041a4 4 0 0 1-3.3-1.8l-.359-.45",key:"os18l9"}]]);function U({challenge:t,onUse:s,onSave:r,onShare:n,onRegenerate:i,isSaved:o}){return e.jsxs(p.div,{initial:{opacity:0,y:20,scale:.95},animate:{opacity:1,y:0,scale:1},transition:{type:"spring",stiffness:300,damping:30},className:"bg-card rounded-2xl border border-border overflow-hidden",children:[e.jsx("div",{className:"h-2 bg-gradient-to-r from-primary via-accent to-gold"}),e.jsxs("div",{className:"p-6 space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-sm text-muted-foreground",children:b.categories[t.category]}),e.jsx(de,{difficulty:t.difficulty,size:"sm"})]}),e.jsx("h3",{className:"font-display text-xl font-bold leading-tight",children:t.title}),e.jsx(ce,{xp:t.xpReward,animated:!0}),e.jsxs("div",{className:"flex gap-2 pt-2",children:[i&&e.jsxs(f,{variant:"outline",size:"sm",onClick:i,className:"gap-2",children:[e.jsx(fe,{className:"w-4 h-4"}),"Другой"]}),r&&e.jsx(f,{variant:"outline",size:"sm",onClick:r,className:o?"text-gold":"",children:e.jsx(pe,{className:`w-4 h-4 ${o?"fill-current":""}`})}),n&&e.jsx(f,{variant:"outline",size:"sm",onClick:n,children:e.jsx(Q,{className:"w-4 h-4"})}),s&&e.jsxs(f,{size:"sm",onClick:s,className:"flex-1 gap-2 bg-gradient-to-r from-primary to-primary/80",children:[e.jsx(Y,{className:"w-4 h-4"}),"Выполнить"]})]})]})]})}function xe({onClick:t,isLoading:s=!1,variant:r="default"}){const[n,i]=u.useState(!1),o=()=>{i(!0),t(),setTimeout(()=>i(!1),600)};return r==="large"?e.jsxs(p.button,{whileHover:{scale:1.02},whileTap:{scale:.98},onClick:o,disabled:s,className:"relative w-full py-6 rounded-2xl bg-gradient-to-r from-primary via-accent to-gold text-primary-foreground font-display text-xl font-bold overflow-hidden group",children:[e.jsx(p.div,{className:"absolute inset-0 bg-gradient-to-r from-transparent via-white/20 to-transparent",initial:{x:"-100%"},animate:n?{x:"100%"}:{x:"-100%"},transition:{duration:.6}}),e.jsxs("span",{className:"relative flex items-center justify-center gap-3",children:[e.jsx(p.div,{animate:n?{rotate:360}:{rotate:0},transition:{duration:.6},children:e.jsx(Z,{className:"w-6 h-6"})}),s?"Генерирую...":"Сгенерировать челлендж"]})]}):e.jsxs(f,{onClick:o,disabled:s,className:"gap-2 bg-gradient-to-r from-primary to-accent",children:[e.jsx(p.div,{animate:n?{rotate:360}:{rotate:0},transition:{duration:.6},children:e.jsx(D,{className:"w-4 h-4"})}),s?"Генерирую...":"Сгенерировать"]})}const ye=["all","creative","nature","urban","portrait","abstract","food","colors","emotions","architecture"],he=["all","easy","medium","hard"];function je({category:t,difficulty:s,onCategoryChange:r,onDifficultyChange:n}){return e.jsxs("div",{className:"flex flex-col sm:flex-row gap-4",children:[e.jsxs("div",{className:"flex-1 space-y-2",children:[e.jsx(M,{htmlFor:"category",className:"text-sm text-muted-foreground",children:"Категория"}),e.jsxs(I,{value:t,onValueChange:r,children:[e.jsx(R,{id:"category",children:e.jsx(L,{placeholder:"Выберите категорию"})}),e.jsxs(B,{children:[e.jsx(y,{value:"all",children:"Все категории"}),ye.slice(1).map(i=>e.jsx(y,{value:i,children:b.categories[i]},i))]})]})]}),e.jsxs("div",{className:"flex-1 space-y-2",children:[e.jsx(M,{htmlFor:"difficulty",className:"text-sm text-muted-foreground",children:"Сложность"}),e.jsxs(I,{value:s,onValueChange:n,children:[e.jsx(R,{id:"difficulty",children:e.jsx(L,{placeholder:"Выберите сложность"})}),e.jsxs(B,{children:[e.jsx(y,{value:"all",children:"Любая"}),he.slice(1).map(i=>e.jsx(y,{value:i,children:b.hunts.difficulty[i]},i))]})]})]})]})}function ge(){return`${Date.now()}-${Math.random().toString(36).substr(2,9)}`}function ve(t){return t[Math.floor(Math.random()*t.length)]}const be=[{id:"tmpl-1",pattern:"Найдите [object] и сфотографируйте в [style]",category:"abstract",difficulty:"easy",variables:[{name:"object",type:"object",options:["красный предмет","круглый объект","что-то блестящее","старинную вещь","симметричный объект"]},{name:"style",type:"style",options:["минималистичном стиле","макро","с необычного ракурса","на закате","с размытым фоном"]}]},{id:"tmpl-2",pattern:'Создайте фото с настроением "[emotion]" используя [color] цвет',category:"mood",difficulty:"medium",variables:[{name:"emotion",type:"emotion",options:["спокойствие","радость","меланхолия","энергия","загадочность"]},{name:"color",type:"color",options:["синий","жёлтый","красный","зелёный","чёрно-белый"]}]},{id:"tmpl-3",pattern:"Сфотографируйте [location] в [time]",category:"urban",difficulty:"hard",variables:[{name:"location",type:"location",options:["улицу","парк","здание","мост","площадь"]},{name:"time",type:"time",options:["золотой час","синий час","полдень","ночью","во время дождя"]}]},{id:"tmpl-4",pattern:"Покажите [object] с точки зрения [angle]",category:"light",difficulty:"medium",variables:[{name:"object",type:"object",options:["вашу еду","рабочее место","любимую вещь","обувь","книгу"]},{name:"angle",type:"angle",options:["сверху (flat lay)","снизу","на уровне глаз","сбоку","через стекло"]}]},{id:"tmpl-5",pattern:"Найдите в городе [object] цвета [color]",category:"color",difficulty:"easy",variables:[{name:"object",type:"object",options:["дверь","машину","цветок","вывеску","скамейку"]},{name:"color",type:"color",options:["красного","синего","жёлтого","зелёного","розового"]}]}];function Ne(t){switch(t){case"easy":return 30+Math.floor(Math.random()*20);case"medium":return 50+Math.floor(Math.random()*30);case"hard":return 80+Math.floor(Math.random()*40);default:return 40}}function we(t,s){let r=t.pattern;const n={};return t.variables.forEach(i=>{const o=ve(i.options);n[i.name]=o,r=r.replace(`[${i.name}]`,o)}),{id:ge(),templateId:t.id,title:r,description:r,variables:n,category:t.category,difficulty:t.difficulty,xpReward:Ne(t.difficulty),generatedAt:new Date().toISOString()}}function Ce(t,s){return t.filter(r=>!(s.category&&r.category!==s.category||s.difficulty&&r.difficulty!==s.difficulty))}const ke=[{id:"tmpl-extra-1",pattern:"Сфотографируйте [object] так, чтобы было видно [detail]",category:"light",difficulty:"medium",variables:[{name:"object",type:"object",options:["ваш обед","чашку кофе","любимую книгу","рабочий стол","окно"]},{name:"detail",type:"style",options:["отражение","тень","текстуру","игру света","глубину"]}]},{id:"tmpl-extra-2",pattern:"Найдите [count] предметов [color] цвета и сфотографируйте их вместе",category:"color",difficulty:"easy",variables:[{name:"count",type:"object",options:["3","5","7"]},{name:"color",type:"color",options:["красного","синего","зелёного","жёлтого","белого"]}]},{id:"tmpl-extra-3",pattern:"Создайте фото в стиле [style] используя только [limitation]",category:"abstract",difficulty:"hard",variables:[{name:"style",type:"style",options:["минимализм","симметрия","хаос","геометрия"]},{name:"limitation",type:"object",options:["естественный свет","один цвет","прямые линии","круглые формы"]}]},{id:"tmpl-extra-4",pattern:"Запечатлейте момент [moment] в вашем дне",category:"mood",difficulty:"easy",variables:[{name:"moment",type:"emotion",options:["спокойствия","радости","ожидания","движения","тишины"]}]},{id:"tmpl-extra-5",pattern:"Сфотографируйте [subject] с [perspective] перспективы",category:"urban",difficulty:"medium",variables:[{name:"subject",type:"location",options:["здание","лестницу","коридор","арку","мост"]},{name:"perspective",type:"angle",options:["низкой","высокой","диагональной","центральной"]}]}],$=[...be,...ke];function Se(t){return{id:t.id,templateId:"db-saved",title:t.title,description:t.description||t.title,variables:{},category:t.category||"creative",difficulty:t.difficulty,xpReward:t.xp_reward,generatedAt:t.created_at,isSaved:!0}}function $e(){const t=ee(),{toast:s}=te(),{user:r}=ae(),[n,i]=u.useState("all"),[o,E]=u.useState("all"),[c,H]=u.useState(null),[w,V]=u.useState([]),[X,C]=u.useState(!1),{data:l,isLoading:_}=se(),F=ie(),k=re(),x=u.useMemo(()=>(l||[]).map(Se),[l]),S=u.useMemo(()=>new Set(x.map(a=>a.title)),[x]),T=u.useCallback(()=>{C(!0),setTimeout(()=>{const a={};n!=="all"&&(a.category=n),o!=="all"&&(a.difficulty=o);const d=Ce($,a),m=d.length>0?d:$,j=m[Math.floor(Math.random()*m.length)],K=we(j);c&&V(O=>[c,...O].slice(0,10)),H(K),C(!1)},400)},[n,o,c]),P=async a=>{if(!r){s({title:"Войдите, чтобы сохранять челленджи",variant:"destructive"});return}const d=S.has(a.title),m=l==null?void 0:l.find(j=>j.title===a.title);if(d&&m)try{await k.mutateAsync(m.id),s({title:"Удалено из сохранённых"})}catch{s({title:"Ошибка при удалении",variant:"destructive"})}else try{await F.mutateAsync({title:a.title,description:a.description,category:a.category,difficulty:a.difficulty,xp_reward:a.xpReward}),s({title:"Сохранено!"})}catch{s({title:"Ошибка при сохранении",variant:"destructive"})}},q=async a=>{if(!r)return;const d=l==null?void 0:l.find(m=>m.id===a.id||m.title===a.title);if(d)try{await k.mutateAsync(d.id),s({title:"Удалено из сохранённых"})}catch{s({title:"Ошибка при удалении",variant:"destructive"})}},h=a=>{const d=l==null?void 0:l.find(m=>m.title===a.title);t(d?`/upload?challenge=${d.id}`:`/upload?challengeTitle=${encodeURIComponent(a.title)}&xp=${a.xpReward}`)},W=async a=>{try{await navigator.share({title:"Фото-челлендж",text:a.title,url:window.location.href})}catch{await navigator.clipboard.writeText(a.title),s({title:"Скопировано в буфер обмена"})}},J=a=>S.has(a.title);return e.jsxs("div",{className:"min-h-screen bg-background",children:[e.jsx("header",{className:"sticky top-0 z-40 bg-background/80 backdrop-blur-lg border-b border-border",children:e.jsxs("div",{className:"container mx-auto px-4 h-16 flex items-center justify-between",children:[e.jsx(f,{variant:"ghost",size:"icon",onClick:()=>t(-1),children:e.jsx(me,{className:"w-5 h-5"})}),e.jsx("h1",{className:"font-display text-lg font-semibold",children:"Генератор"}),e.jsx("div",{className:"w-10"})]})}),e.jsxs("main",{className:"container mx-auto px-4 py-6 space-y-6",children:[e.jsxs(p.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},className:"text-center",children:[e.jsxs("div",{className:"inline-flex items-center gap-2 px-4 py-2 rounded-full bg-secondary border border-border mb-4",children:[e.jsx(D,{className:"w-4 h-4 text-gold"}),e.jsx("span",{className:"text-sm font-medium text-muted-foreground",children:"Бесконечные идеи"})]}),e.jsx("h2",{className:"font-display text-2xl font-bold mb-2",children:"Генератор челленджей"}),e.jsx("p",{className:"text-muted-foreground text-sm max-w-md mx-auto",children:"Не знаете, что сфотографировать? Нажмите кнопку и получите уникальное творческое задание!"})]}),e.jsx(je,{category:n,difficulty:o,onCategoryChange:i,onDifficultyChange:E}),e.jsx(xe,{onClick:T,isLoading:X,variant:"large"}),e.jsx(ue,{mode:"wait",children:c&&e.jsx(U,{challenge:c,onUse:()=>h(c),onSave:()=>P(c),onShare:()=>W(c),onRegenerate:T,isSaved:J(c)},c.id)}),e.jsxs(ne,{defaultValue:"history",className:"w-full",children:[e.jsxs(oe,{className:"grid w-full grid-cols-2",children:[e.jsxs(A,{value:"history",className:"gap-2",children:[e.jsx(G,{className:"w-4 h-4"}),"История"]}),e.jsxs(A,{value:"saved",className:"gap-2",children:[e.jsx(v,{className:"w-4 h-4"}),"Сохранённые"]})]}),e.jsx(z,{value:"history",className:"mt-4 space-y-4",children:w.length>0?w.map(a=>e.jsx(p.div,{initial:{opacity:0},animate:{opacity:1},className:"bg-card rounded-xl border border-border p-4",children:e.jsxs("div",{className:"flex items-start justify-between gap-4",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx("p",{className:"font-medium mb-1",children:a.title}),e.jsxs("p",{className:"text-xs text-muted-foreground",children:["+",a.xpReward," XP"]})]}),e.jsx(f,{variant:"outline",size:"sm",onClick:()=>h(a),children:"Выполнить"})]})},a.id)):e.jsx(g,{icon:G,title:"История пуста",description:"Сгенерированные челленджи появятся здесь"})}),e.jsx(z,{value:"saved",className:"mt-4 space-y-4",children:_?e.jsx("div",{className:"flex items-center justify-center py-12",children:e.jsx(le,{className:"w-8 h-8 animate-spin text-primary"})}):r?x.length>0?x.map(a=>e.jsx(U,{challenge:a,onUse:()=>h(a),onSave:()=>q(a),isSaved:!0},a.id)):e.jsx(g,{icon:v,title:"Нет сохранённых",description:"Сохраняйте понравившиеся челленджи, чтобы вернуться к ним позже"}):e.jsx(g,{icon:v,title:"Войдите в аккаунт",description:"Чтобы сохранять челленджи, необходимо войти в аккаунт"})})]})]})]})}export{$e as default};
