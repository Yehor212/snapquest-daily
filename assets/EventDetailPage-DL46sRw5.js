import{c as k,j as e,m as g,a as u,V as C,B as x,C as j,p as P,r as f,a8 as L,a9 as S,aa as E,ab as I,ac as R,F as _,n as $,Z as A,z as Q,L as U,a6 as B,a7 as v,T as O,i as V,k as y,l as w}from"./index-DFnNWw_v.js";import{U as X}from"./index-CIdSBVH7.js";import{P as q}from"./ProgressRing-C_tbWcMw.js";import{b as H}from"./useEvents-Ck_OYwA_.js";import{X as F}from"./XpBadge-D87dUz-C.js";import{P as G}from"./PhotoGallery-DY00AfJJ.js";import{A as W}from"./arrow-left-kcRMWkuC.js";import"./index-DHdUGGn6.js";/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Z=k("Copy",[["rect",{width:"14",height:"14",x:"8",y:"8",rx:"2",ry:"2",key:"17jyea"}],["path",{d:"M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2",key:"zix9uf"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const J=k("QrCode",[["rect",{width:"5",height:"5",x:"3",y:"3",rx:"1",key:"1tu5fj"}],["rect",{width:"5",height:"5",x:"16",y:"3",rx:"1",key:"1v8r4q"}],["rect",{width:"5",height:"5",x:"3",y:"16",rx:"1",key:"1x03jg"}],["path",{d:"M21 16h-3a2 2 0 0 0-2 2v3",key:"177gqh"}],["path",{d:"M21 21v.01",key:"ents32"}],["path",{d:"M12 7v3a2 2 0 0 1-2 2H7",key:"8crl2c"}],["path",{d:"M3 12h.01",key:"nlz23k"}],["path",{d:"M12 3h.01",key:"n36tog"}],["path",{d:"M12 16v.01",key:"133mhm"}],["path",{d:"M16 12h1",key:"1slzba"}],["path",{d:"M21 12v.01",key:"1lwtk9"}],["path",{d:"M12 21v-1",key:"1880an"}]]);function K({challenges:i,completedIds:l,onChallengeClick:n}){return e.jsx("div",{className:"space-y-3",children:i.map((s,c)=>{const r=l.includes(s.id);return e.jsxs(g.div,{initial:{opacity:0,x:-20},animate:{opacity:1,x:0},transition:{delay:c*.05},className:u("relative flex items-center gap-4 p-4 rounded-xl border transition-all",r?"bg-green-500/10 border-green-500/30":"bg-card border-border hover:border-primary/40 cursor-pointer"),onClick:()=>!r&&n(s),children:[e.jsx("div",{className:u("flex-shrink-0 w-8 h-8 rounded-full flex items-center justify-center text-sm font-bold",r?"bg-green-500 text-white":"bg-secondary text-muted-foreground"),children:r?e.jsx(C,{className:"w-4 h-4"}):s.order}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("h4",{className:u("font-medium text-sm",r&&"line-through text-muted-foreground"),children:s.title}),e.jsx("p",{className:"text-xs text-muted-foreground truncate",children:s.description})]}),e.jsxs("div",{className:"flex-shrink-0 flex items-center gap-2",children:[e.jsx(F,{xp:s.xpReward,size:"sm",showIcon:!1}),!r&&e.jsx(x,{size:"icon",variant:"ghost",className:"h-8 w-8",children:e.jsx(j,{className:"w-4 h-4"})})]})]},s.id)})})}function Y({open:i,onOpenChange:l,eventName:n,accessCode:s}){const{toast:c}=P(),[r,d]=f.useState(!1),o=`Присоединяйся к событию "${n}"!

Код: ${s}

Скачай приложение SnapQuest и введи код.`,p=async()=>{await navigator.clipboard.writeText(s),d(!0),c({title:"Код скопирован!"}),setTimeout(()=>d(!1),2e3)},a=async()=>{try{await navigator.share({title:`Приглашение на ${n}`,text:o})}catch{await navigator.clipboard.writeText(o),c({title:"Приглашение скопировано!"})}};return e.jsx(L,{open:i,onOpenChange:l,children:e.jsxs(S,{className:"sm:max-w-md",children:[e.jsxs(E,{children:[e.jsx(I,{className:"text-center",children:"Пригласить участников"}),e.jsx(R,{className:"text-center",children:"Поделитесь кодом с друзьями, чтобы они присоединились к событию"})]}),e.jsxs("div",{className:"flex flex-col items-center gap-6 py-4",children:[e.jsx("div",{className:"w-48 h-48 rounded-2xl bg-white flex items-center justify-center",children:e.jsxs("div",{className:"text-center",children:[e.jsx(J,{className:"w-24 h-24 text-black mx-auto mb-2"}),e.jsx("p",{className:"text-xs text-black/50",children:"QR-код"})]})}),e.jsxs("div",{className:"w-full",children:[e.jsx("p",{className:"text-sm text-muted-foreground text-center mb-2",children:"Код доступа"}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"flex-1 px-4 py-3 rounded-xl bg-secondary border border-border font-mono text-xl text-center tracking-widest",children:s}),e.jsx(x,{size:"icon",variant:"outline",onClick:p,className:"h-12 w-12",children:r?e.jsx(C,{className:"w-5 h-5 text-green-500"}):e.jsx(Z,{className:"w-5 h-5"})})]})]}),e.jsxs(x,{onClick:a,className:"w-full gap-2",children:[e.jsx(_,{className:"w-4 h-4"}),"Поделиться приглашением"]})]})]})})}function oe(){const i=$(),{id:l}=A(),{user:n}=Q(),{data:s,isLoading:c}=H(l),[r,d]=f.useState(!1),o=f.useMemo(()=>!(s!=null&&s.photos)||!n?[]:s.photos.filter(m=>m.user_id===n.id).filter(m=>m.event_challenge_id).map(m=>m.event_challenge_id),[s==null?void 0:s.photos,n]),p=t=>{i(`/upload?event=${l}&eventChallenge=${t}`)};if(c)return e.jsx("div",{className:"min-h-screen bg-background flex items-center justify-center",children:e.jsx(U,{className:"w-8 h-8 animate-spin text-primary"})});if(!(s!=null&&s.event))return e.jsx("div",{className:"min-h-screen bg-background flex items-center justify-center",children:e.jsx("p",{className:"text-muted-foreground",children:"Событие не найдено"})});const{event:a,challenges:h,participants:T,photos:D}=s,M=(a.start_date?new Date(a.start_date):new Date(a.created_at)).toLocaleDateString("ru-RU",{day:"numeric",month:"long",year:"numeric"}),b=h.length>0?o.length/h.length*100:0,z=h.map(t=>({id:t.id,eventId:t.event_id,title:t.title,description:t.description||"",order:t.order_num,xpReward:t.xp_reward})),N=D.map(t=>({id:t.id,userId:t.user_id,imageData:t.image_url,thumbnailData:t.thumbnail_url||t.image_url,createdAt:t.created_at,likes:t.likes_count,comments:0,isTop:t.likes_count>=10,eventId:t.event_id||void 0}));return e.jsxs("div",{className:"min-h-screen bg-background",children:[e.jsx("header",{className:"sticky top-0 z-40 bg-background/80 backdrop-blur-lg border-b border-border",children:e.jsxs("div",{className:"container mx-auto px-4 h-16 flex items-center justify-between",children:[e.jsx(x,{variant:"ghost",size:"icon",onClick:()=>i("/events"),children:e.jsx(W,{className:"w-5 h-5"})}),e.jsx("h1",{className:"font-display text-lg font-semibold truncate max-w-[200px]",children:a.name}),e.jsx(x,{variant:"ghost",size:"icon",onClick:()=>d(!0),children:e.jsx(_,{className:"w-5 h-5"})})]})}),e.jsxs("main",{className:"container mx-auto px-4 py-6 space-y-6",children:[e.jsxs(g.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},className:"relative h-48 rounded-2xl overflow-hidden",children:[a.cover_image?e.jsx("img",{src:a.cover_image,alt:a.name,className:"w-full h-full object-cover"}):e.jsx("div",{className:"w-full h-full bg-gradient-to-br from-primary/30 to-accent/30"}),e.jsx("div",{className:"absolute inset-0 bg-gradient-to-t from-black/80 via-black/40 to-transparent"}),e.jsxs("div",{className:"absolute bottom-0 left-0 right-0 p-4",children:[e.jsx("div",{className:"flex items-center gap-2 mb-2",children:e.jsx("span",{className:"px-2 py-1 rounded-full bg-white/20 backdrop-blur-sm text-xs font-medium",children:X.events.eventTypes[a.event_type]})}),e.jsx("h2",{className:"font-display text-2xl font-bold text-white mb-2",children:a.name}),e.jsxs("div",{className:"flex items-center gap-4 text-sm text-white/70",children:[e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx(B,{className:"w-4 h-4"}),M]}),e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx(v,{className:"w-4 h-4"}),T.length]})]})]}),e.jsx("div",{className:"absolute top-3 right-3",children:e.jsx("span",{className:"px-3 py-1.5 rounded-lg bg-black/50 backdrop-blur-sm text-sm font-mono",children:a.access_code})})]}),a.description&&e.jsx("p",{className:"text-muted-foreground",children:a.description}),e.jsxs(g.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},className:"bg-card rounded-2xl border border-border p-4 flex items-center gap-4",children:[e.jsx(q,{progress:b,size:64,strokeWidth:5,children:e.jsxs("span",{className:"text-sm font-bold",children:[Math.round(b),"%"]})}),e.jsxs("div",{children:[e.jsxs("p",{className:"font-medium",children:[o.length," из ",h.length," заданий"]}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Выполнено вами"})]})]}),e.jsxs(O,{defaultValue:"challenges",className:"w-full",children:[e.jsxs(V,{className:"grid w-full grid-cols-2",children:[e.jsxs(y,{value:"challenges",className:"gap-2",children:[e.jsx(j,{className:"w-4 h-4"}),"Задания"]}),e.jsxs(y,{value:"gallery",className:"gap-2",children:[e.jsx(v,{className:"w-4 h-4"}),"Галерея"]})]}),e.jsx(w,{value:"challenges",className:"mt-4",children:e.jsx(K,{challenges:z,completedIds:o,onChallengeClick:t=>p(t.id)})}),e.jsx(w,{value:"gallery",className:"mt-4",children:N.length>0?e.jsx(G,{photos:N,columns:2}):e.jsxs("div",{className:"text-center py-12 text-muted-foreground",children:[e.jsx(j,{className:"w-12 h-12 mx-auto mb-3 opacity-50"}),e.jsx("p",{children:"Пока нет фотографий"}),e.jsx("p",{className:"text-sm",children:"Станьте первым!"})]})})]})]}),e.jsx(Y,{open:r,onOpenChange:d,eventName:a.name,accessCode:a.access_code})]})}export{oe as default};
