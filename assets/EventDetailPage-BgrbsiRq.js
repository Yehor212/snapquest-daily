import{c as S,j as e,m as f,a as g,V as C,B as h,C as j,p as z,r as u,a9 as E,aa as I,ab as L,ac as $,ad as R,H as _,n as U,Z as A,q,L as M,a7 as B,a8 as y,T as O,i as Q,k as w,l as k}from"./index-X3YY-C0S.js";import{U as V}from"./index-oazBVSES.js";import{P as X}from"./ProgressRing-YFDnb-jb.js";import{X as H}from"./XpBadge-C-Cp13ih.js";import{P as G}from"./PhotoGallery-BMZ1EmC1.js";import{a as W}from"./useEvents-Dksn9ptY.js";import{A as Z}from"./arrow-left-CtnlzYUZ.js";import"./index-DWgQ6eXM.js";/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const F=S("Copy",[["rect",{width:"14",height:"14",x:"8",y:"8",rx:"2",ry:"2",key:"17jyea"}],["path",{d:"M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2",key:"zix9uf"}]]);function J({challenges:i,completedIds:l,onChallengeClick:n}){return e.jsx("div",{className:"space-y-3",children:i.map((s,c)=>{const r=l.includes(s.id);return e.jsxs(f.div,{initial:{opacity:0,x:-20},animate:{opacity:1,x:0},transition:{delay:c*.05},className:g("relative flex items-center gap-4 p-4 rounded-xl border transition-all",r?"bg-green-500/10 border-green-500/30":"bg-card border-border hover:border-primary/40 cursor-pointer"),onClick:()=>!r&&n(s),children:[e.jsx("div",{className:g("flex-shrink-0 w-8 h-8 rounded-full flex items-center justify-center text-sm font-bold",r?"bg-green-500 text-white":"bg-secondary text-muted-foreground"),children:r?e.jsx(C,{className:"w-4 h-4"}):s.order}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("h4",{className:g("font-medium text-sm",r&&"line-through text-muted-foreground"),children:s.title}),e.jsx("p",{className:"text-xs text-muted-foreground truncate",children:s.description})]}),e.jsxs("div",{className:"flex-shrink-0 flex items-center gap-2",children:[e.jsx(H,{xp:s.xpReward,size:"sm",showIcon:!1}),!r&&e.jsx(h,{size:"icon",variant:"ghost",className:"h-8 w-8",children:e.jsx(j,{className:"w-4 h-4"})})]})]},s.id)})})}function K({open:i,onOpenChange:l,eventName:n,accessCode:s}){const{toast:c}=z(),[r,m]=u.useState(!1),o=`Присоединяйся к событию "${n}"!

Код: ${s}

Скачай приложение SnapQuest и введи код.`,p=u.useMemo(()=>`https://api.qrserver.com/v1/create-qr-code/?size=200x200&data=${encodeURIComponent(`SNAPQUEST:${s}`)}&bgcolor=ffffff&color=000000`,[s]),t=async()=>{await navigator.clipboard.writeText(s),m(!0),c({title:"Код скопирован!"}),setTimeout(()=>m(!1),2e3)},d=async()=>{try{await navigator.share({title:`Приглашение на ${n}`,text:o})}catch{await navigator.clipboard.writeText(o),c({title:"Приглашение скопировано!"})}};return e.jsx(E,{open:i,onOpenChange:l,children:e.jsxs(I,{className:"sm:max-w-md",children:[e.jsxs(L,{children:[e.jsx($,{className:"text-center",children:"Пригласить участников"}),e.jsx(R,{className:"text-center",children:"Поделитесь кодом с друзьями, чтобы они присоединились к событию"})]}),e.jsxs("div",{className:"flex flex-col items-center gap-6 py-4",children:[e.jsx("div",{className:"w-48 h-48 rounded-2xl bg-white flex items-center justify-center overflow-hidden",children:e.jsx("img",{src:p,alt:`QR код для события: ${s}`,className:"w-full h-full object-contain"})}),e.jsxs("div",{className:"w-full",children:[e.jsx("p",{className:"text-sm text-muted-foreground text-center mb-2",children:"Код доступа"}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"flex-1 px-4 py-3 rounded-xl bg-secondary border border-border font-mono text-xl text-center tracking-widest",children:s}),e.jsx(h,{size:"icon",variant:"outline",onClick:t,className:"h-12 w-12",children:r?e.jsx(C,{className:"w-5 h-5 text-green-500"}):e.jsx(F,{className:"w-5 h-5"})})]})]}),e.jsxs(h,{onClick:d,className:"w-full gap-2",children:[e.jsx(_,{className:"w-4 h-4"}),"Поделиться приглашением"]})]})]})})}function ce(){const i=U(),{id:l}=A(),{user:n}=q(),{data:s,isLoading:c}=W(l),[r,m]=u.useState(!1),o=u.useMemo(()=>!(s!=null&&s.photos)||!n?[]:s.photos.filter(x=>x.user_id===n.id).filter(x=>x.event_challenge_id).map(x=>x.event_challenge_id),[s==null?void 0:s.photos,n]),p=a=>{i(`/upload?event=${l}&eventChallenge=${a}`)};if(c)return e.jsx("div",{className:"min-h-screen bg-background flex items-center justify-center",children:e.jsx(M,{className:"w-8 h-8 animate-spin text-primary"})});if(!(s!=null&&s.event))return e.jsx("div",{className:"min-h-screen bg-background flex items-center justify-center",children:e.jsx("p",{className:"text-muted-foreground",children:"Событие не найдено"})});const{event:t,challenges:d,participants:b,photos:T}=s,D=(t.start_date?new Date(t.start_date):new Date(t.created_at)).toLocaleDateString("ru-RU",{day:"numeric",month:"long",year:"numeric"}),N=d.length>0?o.length/d.length*100:0,P=d.map(a=>({id:a.id,eventId:a.event_id,title:a.title,description:a.description||"",order:a.order_num,xpReward:a.xp_reward})),v=T.map(a=>({id:a.id,userId:a.user_id,imageData:a.image_url,thumbnailData:a.thumbnail_url||a.image_url,createdAt:a.created_at,likes:a.likes_count,comments:0,isTop:a.likes_count>=10,eventId:a.event_id||void 0}));return e.jsxs("div",{className:"min-h-screen bg-background",children:[e.jsx("header",{className:"sticky top-0 z-40 bg-background/80 backdrop-blur-lg border-b border-border",children:e.jsxs("div",{className:"container mx-auto px-4 h-16 flex items-center justify-between",children:[e.jsx(h,{variant:"ghost",size:"icon",onClick:()=>i("/events"),children:e.jsx(Z,{className:"w-5 h-5"})}),e.jsx("h1",{className:"font-display text-lg font-semibold truncate max-w-[200px]",children:t.name}),e.jsx(h,{variant:"ghost",size:"icon",onClick:()=>m(!0),children:e.jsx(_,{className:"w-5 h-5"})})]})}),e.jsxs("main",{className:"container mx-auto px-4 py-6 space-y-6",children:[e.jsxs(f.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},className:"relative h-48 rounded-2xl overflow-hidden",children:[t.cover_image?e.jsx("img",{src:t.cover_image,alt:t.name,className:"w-full h-full object-cover"}):e.jsx("div",{className:"w-full h-full bg-gradient-to-br from-primary/30 to-accent/30"}),e.jsx("div",{className:"absolute inset-0 bg-gradient-to-t from-black/80 via-black/40 to-transparent"}),e.jsxs("div",{className:"absolute bottom-0 left-0 right-0 p-4",children:[e.jsx("div",{className:"flex items-center gap-2 mb-2",children:e.jsx("span",{className:"px-2 py-1 rounded-full bg-white/20 backdrop-blur-sm text-xs font-medium",children:V.events.eventTypes[t.event_type]})}),e.jsx("h2",{className:"font-display text-2xl font-bold text-white mb-2",children:t.name}),e.jsxs("div",{className:"flex items-center gap-4 text-sm text-white/70",children:[e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx(B,{className:"w-4 h-4"}),D]}),e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx(y,{className:"w-4 h-4"}),b.length]})]})]}),e.jsx("div",{className:"absolute top-3 right-3",children:e.jsx("span",{className:"px-3 py-1.5 rounded-lg bg-black/50 backdrop-blur-sm text-sm font-mono",children:t.access_code})})]}),t.description&&e.jsx("p",{className:"text-muted-foreground",children:t.description}),e.jsxs(f.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},className:"bg-card rounded-2xl border border-border p-4 flex items-center gap-4",children:[e.jsx(X,{progress:N,size:64,strokeWidth:5,children:e.jsxs("span",{className:"text-sm font-bold",children:[Math.round(N),"%"]})}),e.jsxs("div",{children:[e.jsxs("p",{className:"font-medium",children:[o.length," из ",d.length," заданий"]}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Выполнено вами"})]})]}),e.jsxs(O,{defaultValue:"challenges",className:"w-full",children:[e.jsxs(Q,{className:"grid w-full grid-cols-2",children:[e.jsxs(w,{value:"challenges",className:"gap-2",children:[e.jsx(j,{className:"w-4 h-4"}),"Задания"]}),e.jsxs(w,{value:"gallery",className:"gap-2",children:[e.jsx(y,{className:"w-4 h-4"}),"Галерея"]})]}),e.jsx(k,{value:"challenges",className:"mt-4",children:e.jsx(J,{challenges:P,completedIds:o,onChallengeClick:a=>p(a.id)})}),e.jsx(k,{value:"gallery",className:"mt-4",children:v.length>0?e.jsx(G,{photos:v,columns:2}):e.jsxs("div",{className:"text-center py-12 text-muted-foreground",children:[e.jsx(j,{className:"w-12 h-12 mx-auto mb-3 opacity-50"}),e.jsx("p",{children:"Пока нет фотографий"}),e.jsx("p",{className:"text-sm",children:"Станьте первым!"})]})})]})]}),e.jsx(K,{open:r,onOpenChange:m,eventName:t.name,accessCode:t.access_code})]})}export{ce as default};
