import{c as L,j as e,m as o,a as f,V as T,B as h,C as X,Q as C,Y as I,n as A,Z as E,p as S,r as B,L as w}from"./index-DFnNWw_v.js";import{X as j}from"./XpBadge-D87dUz-C.js";import{D as R}from"./DifficultyBadge-BE_m_wR9.js";import{U as k}from"./index-CIdSBVH7.js";import{L as M}from"./lightbulb-C9oBqBHs.js";import{P as _}from"./ProgressRing-C_tbWcMw.js";import{C as W}from"./circle-check-CruBcSPz.js";import{a as D,d as U,e as $}from"./useHunts-BTPJHiU3.js";import{A as Q}from"./arrow-left-kcRMWkuC.js";/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const V=L("Play",[["polygon",{points:"6 3 20 12 6 21 6 3",key:"1oa8hb"}]]);function Y({task:n,isCompleted:s,order:d,onClick:l,showHint:r=!1}){return e.jsxs(o.div,{initial:{opacity:0,x:-20},animate:{opacity:1,x:0},transition:{delay:d*.05},onClick:l,className:f("relative flex items-start gap-4 p-4 rounded-xl border transition-all cursor-pointer",s?"bg-green-500/10 border-green-500/30":"bg-card border-border hover:border-primary/40"),children:[e.jsx("div",{className:f("flex-shrink-0 w-10 h-10 rounded-full flex items-center justify-center font-bold",s?"bg-green-500 text-white":"bg-secondary text-muted-foreground"),children:s?e.jsx(T,{className:"w-5 h-5"}):e.jsx("span",{children:d})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("h4",{className:f("font-medium mb-1",s&&"line-through text-muted-foreground"),children:n.title}),e.jsx("p",{className:"text-sm text-muted-foreground mb-2",children:n.description}),r&&n.hint&&!s&&e.jsxs("div",{className:"flex items-start gap-2 p-2 rounded-lg bg-gold/10 border border-gold/20 text-sm",children:[e.jsx(M,{className:"w-4 h-4 text-gold flex-shrink-0 mt-0.5"}),e.jsx("span",{className:"text-gold",children:n.hint})]}),e.jsxs("div",{className:"flex items-center gap-2 mt-2",children:[e.jsx(j,{xp:n.xpReward,size:"sm",showIcon:!1}),n.bonusXp&&!s&&e.jsxs("span",{className:"text-xs text-gold",children:["+",n.bonusXp," бонус"]})]})]}),!s&&e.jsx("div",{className:"flex-shrink-0",children:e.jsx(h,{size:"icon",variant:"ghost",children:e.jsx(X,{className:"w-5 h-5"})})})]})}function Z({hunt:n,progress:s,variant:d="detailed"}){const l=(s==null?void 0:s.tasksCompleted.length)||0,r=n.tasks.length,t=r>0?l/r*100:0,x=l===r&&r>0,m=(s==null?void 0:s.totalXpEarned)||0;return d==="compact"?e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(_,{progress:t,size:48,strokeWidth:4,children:e.jsxs("span",{className:"text-xs font-bold",children:[Math.round(t),"%"]})}),e.jsxs("div",{children:[e.jsxs("p",{className:"text-sm font-medium",children:[l," из ",r]}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"заданий"})]})]}):e.jsxs(o.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},className:"bg-card rounded-2xl border border-border p-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsx("h3",{className:"font-display text-lg font-bold",children:"Прогресс"}),x&&e.jsxs("span",{className:"inline-flex items-center gap-1 px-3 py-1 rounded-full bg-gold/20 text-gold text-sm font-medium",children:[e.jsx(C,{className:"w-4 h-4"}),"Завершено!"]})]}),e.jsxs("div",{className:"flex items-center gap-6 mb-6",children:[e.jsx(_,{progress:t,size:80,strokeWidth:6,color:x?"stroke-green-500":"stroke-primary",children:e.jsxs("span",{className:"text-lg font-bold",children:[Math.round(t),"%"]})}),e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-baseline gap-2 mb-1",children:[e.jsx("span",{className:"text-3xl font-bold",children:l}),e.jsxs("span",{className:"text-muted-foreground",children:["/ ",r," заданий"]})]}),e.jsxs("p",{className:"text-sm text-muted-foreground",children:["Заработано: ",e.jsxs("span",{className:"text-gold font-medium",children:[m," XP"]})]})]})]}),e.jsx("div",{className:"flex flex-wrap gap-2",children:n.tasks.map((c,u)=>{const p=s==null?void 0:s.tasksCompleted.includes(c.id);return e.jsxs(o.div,{initial:{scale:0},animate:{scale:1},transition:{delay:u*.05},className:"relative group",children:[p?e.jsx(W,{className:"w-6 h-6 text-green-500"}):e.jsx(I,{className:"w-6 h-6 text-muted-foreground/30"}),e.jsx("div",{className:"absolute bottom-full left-1/2 -translate-x-1/2 mb-2 px-2 py-1 rounded bg-popover text-popover-foreground text-xs whitespace-nowrap opacity-0 group-hover:opacity-100 transition-opacity pointer-events-none",children:c.title})]},c.id)})})]})}function ae(){const n=A(),{id:s}=E(),{toast:d}=S(),{data:l,isLoading:r}=D(s),{data:t,isLoading:x}=U(s),m=$(),[c,u]=B.useState(!1),p=async()=>{if(s)try{await m.mutateAsync(s),d({title:"Охота началась!",description:"Удачи!"})}catch{d({title:"Ошибка",description:"Не удалось начать охоту",variant:"destructive"})}},H=i=>{t&&(t.completed_tasks.includes(i)||n(`/upload?huntId=${s}&huntTask=${i}`))};if(r||x)return e.jsx("div",{className:"min-h-screen bg-background flex items-center justify-center",children:e.jsx(w,{className:"w-8 h-8 animate-spin text-primary"})});if(!(l!=null&&l.hunt))return e.jsx("div",{className:"min-h-screen bg-background flex items-center justify-center",children:e.jsx("p",{className:"text-muted-foreground",children:"Охота не найдена"})});const{hunt:a,tasks:g}=l,b=t!==null,P=(t==null?void 0:t.completed_at)!==null&&(t==null?void 0:t.completed_at)!==void 0,N=g.map(i=>({id:i.id,huntId:i.hunt_id,title:i.title,description:i.description||"",order:i.order_num,xpReward:i.xp_reward,hint:i.hint||void 0})),y=t?{id:t.id,huntId:t.hunt_id,userId:t.user_id,startedAt:t.started_at,tasksCompleted:t.completed_tasks,totalXpEarned:t.total_xp_earned,completedAt:t.completed_at||void 0}:null,v={id:a.id,title:a.title,description:a.description||"",coverImage:a.cover_image||"https://images.unsplash.com/photo-1469474968028-56623f02e42e?w=800",theme:a.theme,difficulty:a.difficulty,duration:a.duration,totalXp:a.total_xp,isActive:a.is_active,tasks:N,createdAt:a.created_at};return e.jsxs("div",{className:"min-h-screen bg-background",children:[e.jsx("header",{className:"sticky top-0 z-40 bg-background/80 backdrop-blur-lg border-b border-border",children:e.jsxs("div",{className:"container mx-auto px-4 h-16 flex items-center justify-between",children:[e.jsx(h,{variant:"ghost",size:"icon",onClick:()=>n("/hunts"),children:e.jsx(Q,{className:"w-5 h-5"})}),e.jsx("h1",{className:"font-display text-lg font-semibold truncate max-w-[200px]",children:a.title}),e.jsx("div",{className:"w-10"})]})}),e.jsxs("main",{className:"container mx-auto px-4 py-6 space-y-6",children:[e.jsxs(o.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},className:"relative h-48 rounded-2xl overflow-hidden",children:[e.jsx("img",{src:v.coverImage,alt:a.title,className:"w-full h-full object-cover"}),e.jsx("div",{className:"absolute inset-0 bg-gradient-to-t from-black/80 via-black/40 to-transparent"}),e.jsxs("div",{className:"absolute bottom-0 left-0 right-0 p-4",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx("span",{className:"px-2 py-1 rounded-full bg-white/20 backdrop-blur-sm text-xs font-medium",children:k.hunts.themes[a.theme]}),e.jsx(R,{difficulty:a.difficulty,size:"sm"}),e.jsx("span",{className:"px-2 py-1 rounded-full bg-white/20 backdrop-blur-sm text-xs font-medium",children:k.hunts.duration[a.duration]})]}),e.jsx("h2",{className:"font-display text-2xl font-bold text-white mb-1",children:a.title}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(j,{xp:a.total_xp}),e.jsxs("span",{className:"text-sm text-white/70",children:[g.length," заданий"]})]})]})]}),a.description&&e.jsx("p",{className:"text-muted-foreground",children:a.description}),b&&y&&e.jsx(Z,{hunt:v,progress:y}),b?e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("h3",{className:"font-display text-lg font-bold",children:"Задания"}),e.jsx(h,{variant:"ghost",size:"sm",onClick:()=>u(!c),children:c?"Скрыть подсказки":"Показать подсказки"})]}),N.map((i,z)=>e.jsx(Y,{task:i,order:z+1,isCompleted:(t==null?void 0:t.completed_tasks.includes(i.id))||!1,onClick:()=>H(i.id),showHint:c},i.id))]}):e.jsx(o.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},className:"text-center py-8",children:e.jsxs(h,{size:"lg",onClick:p,disabled:m.isPending,className:"gap-2 bg-gradient-to-r from-primary to-accent",children:[m.isPending?e.jsx(w,{className:"w-5 h-5 animate-spin"}):e.jsx(V,{className:"w-5 h-5"}),"Начать охоту"]})}),P&&e.jsxs(o.div,{initial:{opacity:0,scale:.9},animate:{opacity:1,scale:1},className:"bg-gold/10 border border-gold/30 rounded-2xl p-6 text-center",children:[e.jsx(C,{className:"w-12 h-12 text-gold mx-auto mb-3"}),e.jsx("h3",{className:"font-display text-xl font-bold mb-2",children:"Поздравляем!"}),e.jsx("p",{className:"text-muted-foreground mb-4",children:"Вы успешно завершили эту охоту"}),e.jsx(j,{xp:(t==null?void 0:t.total_xp_earned)||0,size:"lg"})]})]})]})}export{ae as default};
